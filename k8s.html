<!DOCTYPE html>
<!-- saved from url=(0055)https://www.cnblogs.com/renshengdezheli/p/17581423.html -->
<html lang="zh-cn" data-arp="" style="--olcb-folder-code-block-max-height: 80vh; --cnb-code-bg: rgb(253, 246, 227); --cnb-code-font-size: 16px; --cnb-code-color: rgb(101, 123, 131);"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="origin-when-cross-origin">
    <meta name="keywords" content="完整项目实战,docker容器,Kubernetes(k8s)管理">
    <meta name="description" content="DevOps实战：使用GitLab+Jenkins+Kubernetes(k8s)建立CICD解决方案。DevOps简介，CI/CD简介，安装并配置docker参数，使用registry搭建镜像仓库，安装部署gitlab代码仓库，创建Git版本库，安装部署CI/CD服务器jenkins，配置Jenk">
    <meta property="og:description" content="DevOps实战：使用GitLab+Jenkins+Kubernetes(k8s)建立CICD解决方案。DevOps简介，CI/CD简介，安装并配置docker参数，使用registry搭建镜像仓库，安装部署gitlab代码仓库，创建Git版本库，安装部署CI/CD服务器jenkins，配置Jenk">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>DevOps实战：使用GitLab+Jenkins+Kubernetes(k8s)建立CI/CD解决方案 - 人生的哲理 - 博客园</title>
    <link rel="icon" id="favicon" href="https://assets.cnblogs.com/favicon_v3_2.ico" type="image/x-icon">
    <link rel="canonical" href="https://www.cnblogs.com/renshengdezheli/p/17581423.html">
    
    <style>#home :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([class*="language-"]):not([highlighted]):not(.hljs):not([class*="brush:"]), :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([class*="language-"]):not([highlighted]):not(.hljs):not([class*="brush:"]) {background: rgb(253, 246, 227);
        padding: 16px;
        border: 0px none rgb(101, 123, 131);
        border-radius: 4.8px;
        border-color: transparent;
        color: rgb(101, 123, 131);
        font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;
        font-size: 16px</style><link rel="stylesheet" href="./k8s_files/blog-common.min.css">
    

    <link id="MainCss" rel="stylesheet" href="./k8s_files/bundle-codinglife.min.css">
        <link id="highlighter-theme-prism-solarizedlight" type="text/css" rel="stylesheet" href="./k8s_files/prism-solarizedlight.css">
    <link type="text/css" rel="stylesheet" href="./k8s_files/custom.css">
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./k8s_files/bundle-codinglife-mobile.min.css">
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/renshengdezheli/rss">
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/renshengdezheli/rsd.xml">
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/renshengdezheli/wlwmanifest.xml">
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "@id": "https://www.cnblogs.com/renshengdezheli/p/17581423.html",
      "headline": "DevOps实战：使用GitLab&#x2B;Jenkins&#x2B;Kubernetes(k8s)建立CI/CD解决方案",
      "description": "[TOC] # 一.系统环境 本文主要基于Kubernetes1.21.9和Linux操作系统CentOS7.4。 | 服务器版本 | docker软件版本 | Kubernetes(k8s)集群版本 | CPU架构 | | | | | | | CentOS Linux release 7.4.17",
      "image": [
        
      ],
      "author": {
        "@type": "Person",
        "@id": "https://www.cnblogs.com/renshengdezheli/",
        "name": "人生的哲理",
        "url": "https://www.cnblogs.com/renshengdezheli/"
      },
      "publisher": {
        "@type": "Organization",
        "@id": "https://www.cnblogs.com/",
        "name": "博客园",
        "url": "https://www.cnblogs.com/"
      },
      "datePublished": "2023-07-26T02:42:00.0000000&#x2B;08:00",
      "dateModified": "2023-07-28T15:58:00.0000000&#x2B;08:00",
      "wordCount": "45649",
      "isPartOf": {
        "@type": "Blog",
        "@id": "https://www.cnblogs.com/renshengdezheli/",
        "name": "人生的哲理",
        "publisher": {
          "@type": "Organization",
          "@id": "https://www.cnblogs.com/",
          "name": "博客园"
        }
      }
    }
    </script>

    <script>
        var currentBlogId = 561551;
        var currentBlogApp = 'renshengdezheli';
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'CodingLife';
        var visitorUserId = '';
        var hasCustomScript = false;
        window.cb_enable_mathjax = true;
        window.mathEngine = 0;
        window.codeHighlightEngine = 2;
        window.enableCodeLineNumber = false;
        window.codeHighlightTheme = 'prism-solarizedlight';
        window.darkModeCodeHighlightTheme = 'prism-base16-ateliersulphurpool.light';
        window.isDarkCodeHighlightTheme = false;
        window.isDarkModeCodeHighlightThemeDark = false;
        window.isDisableCodeHighlighter = false;
        window.enableCodeThemeTypeFollowSystem = false;
        window.enableMacStyleCodeBlock = false;
    </script>
        <script>
            window.currentPostId = 17581423;
            window.currentPostDateAdded = '2023-07-26 02:42';
        </script>
    <script src="./k8s_files/jquery-3.3.1.min.js.下载"></script>
    <script src="./k8s_files/blog-common.min.js.下载"></script><style>.medium-zoom-overlay {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  opacity: 0;
  transition: opacity 300ms;
  will-change: opacity;
}

.medium-zoom--opened .medium-zoom-overlay {
  cursor: pointer;
  cursor: zoom-out;
  opacity: 1;
}

.medium-zoom-image {
  cursor: pointer;
  cursor: zoom-in;
  /*
    The `transition` is marked as "!important" for the animation to happen
    even though it's overriden by another inline `transition` style attribute.

    This is problematic with frameworks that generate inline styles on their
    images (e.g. Gatsby).

    See https://github.com/francoischalifour/medium-zoom/issues/110
   */
  transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1) !important;
}

.medium-zoom-image--hidden {
  visibility: hidden;
}

.medium-zoom-image--opened {
  position: relative;
  cursor: pointer;
  cursor: zoom-out;
  will-change: transform;
}
</style><script id="prismjs-script" src="./k8s_files/prism.js.下载" type="text/javascript" async=""></script>
    
<script id="mathjax" src="./k8s_files/MathJax.js.下载" type="text/javascript" async=""></script><script id="prismjs-autoloader-script" src="./k8s_files/prism-autoloader.min.js.下载" type="text/javascript" async=""></script><meta property="og:image" content="https://typorablogimage.oss-cn-hangzhou.aliyuncs.com/image-20230713162047388.png"><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.mjx-chtml {display: inline-block; line-height: 0; text-indent: 0; text-align: left; text-transform: none; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; letter-spacing: normal; word-wrap: normal; word-spacing: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; margin: 0; padding: 1px 0}
.MJXc-display {display: block; text-align: center; margin: 1em 0; padding: 0}
.mjx-chtml[tabindex]:focus, body :focus .mjx-chtml[tabindex] {display: inline-table}
.mjx-full-width {text-align: center; display: table-cell!important; width: 10000em}
.mjx-math {display: inline-block; border-collapse: separate; border-spacing: 0}
.mjx-math * {display: inline-block; -webkit-box-sizing: content-box!important; -moz-box-sizing: content-box!important; box-sizing: content-box!important; text-align: left}
.mjx-numerator {display: block; text-align: center}
.mjx-denominator {display: block; text-align: center}
.MJXc-stacked {height: 0; position: relative}
.MJXc-stacked > * {position: absolute}
.MJXc-bevelled > * {display: inline-block}
.mjx-stack {display: inline-block}
.mjx-op {display: block}
.mjx-under {display: table-cell}
.mjx-over {display: block}
.mjx-over > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-under > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-stack > .mjx-sup {display: block}
.mjx-stack > .mjx-sub {display: block}
.mjx-prestack > .mjx-presup {display: block}
.mjx-prestack > .mjx-presub {display: block}
.mjx-delim-h > .mjx-char {display: inline-block}
.mjx-surd {vertical-align: top}
.mjx-mphantom * {visibility: hidden}
.mjx-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 2px 3px; font-style: normal; font-size: 90%}
.mjx-annotation-xml {line-height: normal}
.mjx-menclose > svg {fill: none; stroke: currentColor}
.mjx-mtr {display: table-row}
.mjx-mlabeledtr {display: table-row}
.mjx-mtd {display: table-cell; text-align: center}
.mjx-label {display: table-row}
.mjx-box {display: inline-block}
.mjx-block {display: block}
.mjx-span {display: inline}
.mjx-char {display: block; white-space: pre}
.mjx-itable {display: inline-table; width: auto}
.mjx-row {display: table-row}
.mjx-cell {display: table-cell}
.mjx-table {display: table; width: 100%}
.mjx-line {display: block; height: 0}
.mjx-strut {width: 0; padding-top: 1em}
.mjx-vsize {width: 0}
.MJXc-space1 {margin-left: .167em}
.MJXc-space2 {margin-left: .222em}
.MJXc-space3 {margin-left: .278em}
.mjx-chartest {display: block; visibility: hidden; position: absolute; top: 0; line-height: normal; font-size: 500%}
.mjx-chartest .mjx-char {display: inline}
.mjx-chartest .mjx-box {padding-top: 1000px}
.MJXc-processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MJXc-processed {display: none}
.mjx-test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.mjx-test.mjx-test-display {display: table!important}
.mjx-test.mjx-test-inline {display: inline!important; margin-right: -1px}
.mjx-test.mjx-test-default {display: block!important; clear: both}
.mjx-ex-box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.mjx-test-inline .mjx-left-box {display: inline-block; width: 0; float: left}
.mjx-test-inline .mjx-right-box {display: inline-block; width: 0; float: right}
.mjx-test-display .mjx-right-box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
#MathJax_CHTML_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.mjx-chtml .mjx-noError {line-height: 1.2; vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
.MJXc-TeX-unknown-R {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: normal}
.MJXc-TeX-unknown-I {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: normal}
.MJXc-TeX-unknown-B {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: bold}
.MJXc-TeX-unknown-BI {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: bold}
.MJXc-TeX-ams-R {font-family: MJXc-TeX-ams-R,MJXc-TeX-ams-Rw}
.MJXc-TeX-cal-B {font-family: MJXc-TeX-cal-B,MJXc-TeX-cal-Bx,MJXc-TeX-cal-Bw}
.MJXc-TeX-frak-R {font-family: MJXc-TeX-frak-R,MJXc-TeX-frak-Rw}
.MJXc-TeX-frak-B {font-family: MJXc-TeX-frak-B,MJXc-TeX-frak-Bx,MJXc-TeX-frak-Bw}
.MJXc-TeX-math-BI {font-family: MJXc-TeX-math-BI,MJXc-TeX-math-BIx,MJXc-TeX-math-BIw}
.MJXc-TeX-sans-R {font-family: MJXc-TeX-sans-R,MJXc-TeX-sans-Rw}
.MJXc-TeX-sans-B {font-family: MJXc-TeX-sans-B,MJXc-TeX-sans-Bx,MJXc-TeX-sans-Bw}
.MJXc-TeX-sans-I {font-family: MJXc-TeX-sans-I,MJXc-TeX-sans-Ix,MJXc-TeX-sans-Iw}
.MJXc-TeX-script-R {font-family: MJXc-TeX-script-R,MJXc-TeX-script-Rw}
.MJXc-TeX-type-R {font-family: MJXc-TeX-type-R,MJXc-TeX-type-Rw}
.MJXc-TeX-cal-R {font-family: MJXc-TeX-cal-R,MJXc-TeX-cal-Rw}
.MJXc-TeX-main-B {font-family: MJXc-TeX-main-B,MJXc-TeX-main-Bx,MJXc-TeX-main-Bw}
.MJXc-TeX-main-I {font-family: MJXc-TeX-main-I,MJXc-TeX-main-Ix,MJXc-TeX-main-Iw}
.MJXc-TeX-main-R {font-family: MJXc-TeX-main-R,MJXc-TeX-main-Rw}
.MJXc-TeX-math-I {font-family: MJXc-TeX-math-I,MJXc-TeX-math-Ix,MJXc-TeX-math-Iw}
.MJXc-TeX-size1-R {font-family: MJXc-TeX-size1-R,MJXc-TeX-size1-Rw}
.MJXc-TeX-size2-R {font-family: MJXc-TeX-size2-R,MJXc-TeX-size2-Rw}
.MJXc-TeX-size3-R {font-family: MJXc-TeX-size3-R,MJXc-TeX-size3-Rw}
.MJXc-TeX-size4-R {font-family: MJXc-TeX-size4-R,MJXc-TeX-size4-Rw}
.MJXc-TeX-vec-R {font-family: MJXc-TeX-vec-R,MJXc-TeX-vec-Rw}
.MJXc-TeX-vec-B {font-family: MJXc-TeX-vec-B,MJXc-TeX-vec-Bx,MJXc-TeX-vec-Bw}
@font-face {font-family: MJXc-TeX-ams-R; src: local('MathJax_AMS'), local('MathJax_AMS-Regular')}
@font-face {font-family: MJXc-TeX-ams-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_AMS-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-B; src: local('MathJax_Caligraphic Bold'), local('MathJax_Caligraphic-Bold')}
@font-face {font-family: MJXc-TeX-cal-Bx; src: local('MathJax_Caligraphic'); font-weight: bold}
@font-face {font-family: MJXc-TeX-cal-Bw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Bold.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Bold.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-R; src: local('MathJax_Fraktur'), local('MathJax_Fraktur-Regular')}
@font-face {font-family: MJXc-TeX-frak-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-B; src: local('MathJax_Fraktur Bold'), local('MathJax_Fraktur-Bold')}
@font-face {font-family: MJXc-TeX-frak-Bx; src: local('MathJax_Fraktur'); font-weight: bold}
@font-face {font-family: MJXc-TeX-frak-Bw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Bold.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Bold.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-BI; src: local('MathJax_Math BoldItalic'), local('MathJax_Math-BoldItalic')}
@font-face {font-family: MJXc-TeX-math-BIx; src: local('MathJax_Math'); font-weight: bold; font-style: italic}
@font-face {font-family: MJXc-TeX-math-BIw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Math-BoldItalic.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Math-BoldItalic.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Math-BoldItalic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-R; src: local('MathJax_SansSerif'), local('MathJax_SansSerif-Regular')}
@font-face {font-family: MJXc-TeX-sans-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-B; src: local('MathJax_SansSerif Bold'), local('MathJax_SansSerif-Bold')}
@font-face {font-family: MJXc-TeX-sans-Bx; src: local('MathJax_SansSerif'); font-weight: bold}
@font-face {font-family: MJXc-TeX-sans-Bw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Bold.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Bold.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-I; src: local('MathJax_SansSerif Italic'), local('MathJax_SansSerif-Italic')}
@font-face {font-family: MJXc-TeX-sans-Ix; src: local('MathJax_SansSerif'); font-style: italic}
@font-face {font-family: MJXc-TeX-sans-Iw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Italic.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Italic.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-script-R; src: local('MathJax_Script'), local('MathJax_Script-Regular')}
@font-face {font-family: MJXc-TeX-script-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Script-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Script-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Script-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-type-R; src: local('MathJax_Typewriter'), local('MathJax_Typewriter-Regular')}
@font-face {font-family: MJXc-TeX-type-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Typewriter-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Typewriter-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Typewriter-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-R; src: local('MathJax_Caligraphic'), local('MathJax_Caligraphic-Regular')}
@font-face {font-family: MJXc-TeX-cal-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-B; src: local('MathJax_Main Bold'), local('MathJax_Main-Bold')}
@font-face {font-family: MJXc-TeX-main-Bx; src: local('MathJax_Main'); font-weight: bold}
@font-face {font-family: MJXc-TeX-main-Bw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Main-Bold.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-I; src: local('MathJax_Main Italic'), local('MathJax_Main-Italic')}
@font-face {font-family: MJXc-TeX-main-Ix; src: local('MathJax_Main'); font-style: italic}
@font-face {font-family: MJXc-TeX-main-Iw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Main-Italic.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-R; src: local('MathJax_Main'), local('MathJax_Main-Regular')}
@font-face {font-family: MJXc-TeX-main-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Main-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-I; src: local('MathJax_Math Italic'), local('MathJax_Math-Italic')}
@font-face {font-family: MJXc-TeX-math-Ix; src: local('MathJax_Math'); font-style: italic}
@font-face {font-family: MJXc-TeX-math-Iw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Math-Italic.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size1-R; src: local('MathJax_Size1'), local('MathJax_Size1-Regular')}
@font-face {font-family: MJXc-TeX-size1-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Size1-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size2-R; src: local('MathJax_Size2'), local('MathJax_Size2-Regular')}
@font-face {font-family: MJXc-TeX-size2-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Size2-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size3-R; src: local('MathJax_Size3'), local('MathJax_Size3-Regular')}
@font-face {font-family: MJXc-TeX-size3-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Size3-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size4-R; src: local('MathJax_Size4'), local('MathJax_Size4-Regular')}
@font-face {font-family: MJXc-TeX-size4-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Size4-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-vec-R; src: local('MathJax_Vector'), local('MathJax_Vector-Regular')}
@font-face {font-family: MJXc-TeX-vec-Rw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Vector-Regular.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Vector-Regular.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Vector-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-vec-B; src: local('MathJax_Vector Bold'), local('MathJax_Vector-Bold')}
@font-face {font-family: MJXc-TeX-vec-Bx; src: local('MathJax_Vector'); font-weight: bold}
@font-face {font-family: MJXc-TeX-vec-Bw; src /*1*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/eot/MathJax_Vector-Bold.eot'); src /*2*/: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Vector-Bold.woff') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Vector-Bold.otf') format('opentype')}
</style></head>
<body class="skin-codinglife no-navbar mathjax2 prismjs-engine"><div id="MathJax_Message" style="display: none;"></div>
    <a name="top"></a>
    <div id="top_nav" class="navbar forpc navbar-custom">
        <nav id="nav_main" class="navbar-main">
            <ul id="nav_left" class="navbar-list navbar-left">
                <li class="navbar-branding">                    
                    <a href="https://www.cnblogs.com/" title="开发者的网上家园" role="banner">
                        <img src="./k8s_files/logo.svg" alt="博客园logo">
                    </a>
                </li>
                    <li><a href="https://cnblogs.vip/">会员</a></li>
                    <li><a href="https://cnblogs.vip/store">商店</a></li>
                        <li><a href="https://www.cnblogs.com/cmt/p/18500368">众包</a></li>
                <li>
                    <a href="https://news.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-news&#39;)">新闻</a>
                </li>
                <li>
                    <a href="https://q.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-q&#39;)">博问</a>
                </li>
                <li>
                    <a href="https://ing.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-ing&#39;)">闪存</a>
                </li>
                <li><a href="https://www.cnblogs.com/cmt/p/18341478">赞助商</a></li>
                <li><a href="https://chat2db-ai.com/" target="_blank" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-chat2db&#39;)">Chat2DB</a></li>
            </ul>
            <ul id="nav_right" class="navbar-list navbar-right">
                <li>
                    <form id="zzk_search" class="navbar-search dropdown" action="https://zzk.cnblogs.com/s" method="get" role="search">
                        <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="search" tabindex="3" autocomplete="off">
                        <button id="zzk_search_button" onclick="window.navbarSearchManager.triggerActiveOption()">
                            <img id="search_icon" class="focus-hidden" src="./k8s_files/search.svg" alt="搜索">
                            <img class="hidden focus-visible" src="./k8s_files/enter.svg" alt="搜索">
                        </button>
                        <ul id="navbar_search_options" class="dropdown-menu quick-search-menu">
                            <li tabindex="0" class="active" onclick="zzkSearch(event, document.getElementById(&#39;zzk_search_input&#39;).value)">
                                <div class="keyword-wrapper">
                                    <img src="./k8s_files/search.svg" alt="搜索">
                                    <div class="keyword"></div>
                                </div>
                                <span class="search-area">所有博客</span>
                            </li>
                                    <li tabindex="1" onclick="zzkBlogSearch(event, &#39;renshengdezheli&#39;, document.getElementById(&#39;zzk_search_input&#39;).value)">
                                        <div class="keyword-wrapper">
                                            <img src="./k8s_files/search.svg" alt="搜索">
                                            <div class="keyword"></div>
                                        </div>
                                        <span class="search-area">当前博客</span>
                                    </li>
                        </ul>
                    </form>
                </li>
                <li id="navbar_login_status" class="navbar-list">
                    <a class="navbar-user-info navbar-blog" href="https://i.cnblogs.com/EditPosts.aspx?opt=1" alt="写随笔" title="写随笔" style="display: none;">
                        <img id="new_post_icon" class="navbar-icon" src="./k8s_files/newpost.svg" alt="写随笔">
                    </a>
                    <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客" style="display: none;">
                        <img id="myblog_icon" class="navbar-icon" src="./k8s_files/myblog.svg" alt="我的博客">
                    </a>
                    <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息" style="display: none;">
                        <img id="msg_icon" class="navbar-icon" src="./k8s_files/message.svg" alt="短消息">
                        <span id="msg_count" style="display: none"></span>
                    </a>
                    <a id="navbar_lite_mode_indicator" data-current-page="blog" style="display: none" href="javascript:void(0)" alt="简洁模式" title="简洁模式启用，您在访问他人博客时会使用简洁款皮肤展示">
                        <img class="navbar-icon" src="./k8s_files/lite-mode-on.svg" alt="简洁模式">
                    </a>
                    <div id="user_info" class="navbar-user-info dropdown" style="display: none;">
                        <a class="dropdown-button" href="https://home.cnblogs.com/">
                            <img id="user_icon" class="navbar-avatar" src="./k8s_files/avatar-default.svg" alt="用户头像">
                        </a>
                        <div class="dropdown-menu">
                            <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                            <a href="https://home.cnblogs.com/">我的园子</a>
                            <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                            <a href="https://vip.cnblogs.com/my">会员中心</a>
                            <a href="javascript:void(0)" id="navbar_lite_mode_toggle" title="简洁模式会使用简洁款皮肤显示所有博客">
    简洁模式 <span id="navbar_lite_mode_spinner" class="hide">...</span>
</a>

                            <a href="javascript:void(0)" onclick="account.logout();">退出登录</a>
                        </div>
                    </div>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signup" style="display: inline;">注册</a>
                    <a class="navbar-anonymous" href="javascript:void(0);" onclick="account.login()" style="display: inline;">登录</a>
                </li>
            </ul>
        </nav>
    </div>

    

    <!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/renshengdezheli/"><img id="blogLogo" src="./k8s_files/logo.gif" alt="返回主页"></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/renshengdezheli">人生的哲理</a>
</h1>
<h2></h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/renshengdezheli/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/%E4%BA%BA%E7%94%9F%E7%9A%84%E5%93%B2%E7%90%86">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/renshengdezheli/rss/">
订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			<span id="stats_post_count">随笔 - 148&nbsp; </span>
<span id="stats_article_count">文章 - 0&nbsp; </span>
<span id="stats-comment_count">评论 - 210&nbsp; </span>
<span id="stats-total-view-count">阅读 - 
<span title="总阅读数: 466927">
46万</span></span>

		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/renshengdezheli/p/17581423.html" title="发布于 2023-07-26 02:42">
    <span role="heading" aria-level="2">DevOps实战：使用GitLab+Jenkins+Kubernetes(k8s)建立CI/CD解决方案</span>
    

</a><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        DevOps实战：使用GitLab+Jenkins+Kubernetes(k8s)建立CICD解决方案。DevOps简介，CI/CD简介，安装并配置docker参数，使用registry搭建镜像仓库，安装部署gitlab代码仓库，创建Git版本库，安装部署CI/CD服务器jenkins，配置Jenkins连接Kubernetes(k8s)集群，创建jenkins项目，创建deployment，配置gitlab触发jenkins，测试DevOps，总结
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p></p><div class="toc"><div class="toc-container-header">目录</div><ul><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E4%B8%80%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83" rel="noopener nofollow">一.系统环境</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E4%BA%8C%E5%89%8D%E8%A8%80" rel="noopener nofollow">二.前言</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E4%B8%89devops%E7%AE%80%E4%BB%8B" rel="noopener nofollow">三.DevOps简介</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E5%9B%9Bcicd%E7%AE%80%E4%BB%8B" rel="noopener nofollow">四.CI/CD简介</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E4%BA%94%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AEdocker%E5%8F%82%E6%95%B0" rel="noopener nofollow">五.安装并配置docker参数</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E5%85%AD%E4%BD%BF%E7%94%A8registry%E6%90%AD%E5%BB%BA%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93" rel="noopener nofollow">六.使用registry搭建镜像仓库</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E4%B8%83%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2gitlab%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93" rel="noopener nofollow">七.安装部署gitlab代码仓库</a><ul><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#71-%E5%88%9B%E5%BB%BAgitlab%E5%AE%B9%E5%99%A8" rel="noopener nofollow">7.1 创建gitlab容器</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#72-%E4%BF%AE%E6%94%B9gitlab%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="noopener nofollow">7.2 修改gitlab容器配置文件</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#73-%E8%AE%BF%E9%97%AEgitlab-web%E7%95%8C%E9%9D%A2" rel="noopener nofollow">7.3 访问gitlab web界面</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#74-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE" rel="noopener nofollow">7.4 创建项目</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#75-%E5%88%9B%E5%BB%BAgit%E7%89%88%E6%9C%AC%E5%BA%93" rel="noopener nofollow">7.5 创建Git版本库</a></li></ul></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E5%85%AB%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2cicd%E6%9C%8D%E5%8A%A1%E5%99%A8jenkins" rel="noopener nofollow">八.安装部署CI/CD服务器jenkins</a><ul><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#81-%E5%88%9B%E5%BB%BAjenkins%E5%AE%B9%E5%99%A8" rel="noopener nofollow">8.1 创建jenkins容器</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#82-%E4%BF%AE%E6%94%B9jenkins%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="noopener nofollow">8.2 修改Jenkins配置文件</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#83-%E6%9F%A5%E7%9C%8Bjenkins%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E5%B9%B6%E7%99%BB%E5%BD%95" rel="noopener nofollow">8.3 查看jenkins管理员密码并登录</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#84-%E5%AE%89%E8%A3%85jenkins%E6%8F%92%E4%BB%B6" rel="noopener nofollow">8.4 安装Jenkins插件</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#85-%E9%85%8D%E7%BD%AEjenkins%E8%BF%9E%E6%8E%A5docker" rel="noopener nofollow">8.5 配置Jenkins连接docker</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#86-%E5%AE%89%E5%85%A8%E8%AE%BE%E7%BD%AE" rel="noopener nofollow">8.6 安全设置</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#87-%E9%85%8D%E7%BD%AEjenkins%E8%BF%9E%E6%8E%A5kubernetesk8s%E9%9B%86%E7%BE%A4" rel="noopener nofollow">8.7 配置Jenkins连接Kubernetes(k8s)集群</a></li></ul></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E4%B9%9D%E5%88%9B%E5%BB%BAjenkins%E9%A1%B9%E7%9B%AE" rel="noopener nofollow">九.创建jenkins项目</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E5%8D%81%E5%88%9B%E5%BB%BAdeployment" rel="noopener nofollow">十.创建deployment</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E5%8D%81%E4%B8%80%E9%85%8D%E7%BD%AEgitlab%E8%A7%A6%E5%8F%91jenkins" rel="noopener nofollow">十一.配置gitlab触发jenkins</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E5%8D%81%E4%BA%8C%E6%B5%8B%E8%AF%95devops" rel="noopener nofollow">十二.测试DevOps</a><ul><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#121-%E5%86%99%E4%BB%A3%E7%A0%81" rel="noopener nofollow">12.1 写代码</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#122-%E4%B8%8A%E4%BC%A0%E4%BB%A3%E7%A0%81%E5%88%B0gitlab" rel="noopener nofollow">12.2 上传代码到gitlab</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#123-jenkins%E6%89%A7%E8%A1%8Ccicd%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B" rel="noopener nofollow">12.3 Jenkins执行CI/CD(自动构建自动部署)流程</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#124-%E5%86%8D%E8%AF%95%E4%B8%80%E6%AC%A1" rel="noopener nofollow">12.4 再试一次</a></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#125-%E9%99%8D%E4%BD%8E%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%BB%A7%E7%BB%AD%E6%B5%8B%E8%AF%95cicd" rel="noopener nofollow">12.5 降低用户权限继续测试CI/CD</a></li></ul></li><li><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#%E5%8D%81%E4%B8%89%E6%80%BB%E7%BB%93" rel="noopener nofollow">十三.总结</a></li></ul></div><p></p>
<h1 id="一系统环境">一.系统环境<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>本文主要基于Kubernetes1.21.9和Linux操作系统CentOS7.4。</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>服务器版本</th>
<th>docker软件版本</th>
<th>Kubernetes(k8s)集群版本</th>
<th>CPU架构</th>
</tr>
</thead>
<tbody>
<tr>
<td>CentOS Linux release 7.4.1708 (Core)</td>
<td>Docker version 20.10.12</td>
<td>v1.21.9</td>
<td>x86_64</td>
</tr>
</tbody>
</table></div>
<p>CI/CD解决方案架构图：</p>
<p><img src="./k8s_files/image-20230713162047388.png" alt="image-20230713162047388" loading="lazy" class="medium-zoom-image"></p>
<p>CI/CD解决方案架构图描述：</p>
<p>程序员写好代码之后，向gitlab代码仓库提交代码，gitlab检测到变化之后，触发CI/CD服务器Jenkins，CI/CD服务器</p>
<p>Jenkins构建镜像，镜像构建好之后推送到registry镜像仓库，最后使用新的镜像在Kubernetes(k8s)环境部署。</p>
<p>CI/CD解决方案架构：k8scloude1作为Kubernetes(k8s)的master节点，k8scloude2，k8scloude3作为Kubernetes(k8s)的worker节点，由于机器有限，etcd1作为CI/CD服务器，镜像仓库，代码仓库。</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>服务器</th>
<th>操作系统版本</th>
<th>CPU架构</th>
<th>进程</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>etcd1/192.168.110.133</td>
<td>CentOS Linux release 7.4.1708 (Core)</td>
<td>x86_64</td>
<td>docker，jenkins</td>
<td>CI/CD服务器</td>
</tr>
<tr>
<td>etcd1/192.168.110.133</td>
<td>CentOS Linux release 7.4.1708 (Core)</td>
<td>x86_64</td>
<td>registry</td>
<td>镜像仓库</td>
</tr>
<tr>
<td>etcd1/192.168.110.133</td>
<td>CentOS Linux release 7.4.1708 (Core)</td>
<td>x86_64</td>
<td>gitlab，Git</td>
<td>代码仓库</td>
</tr>
<tr>
<td>k8scloude1/192.168.110.130</td>
<td>CentOS Linux release 7.4.1708 (Core)</td>
<td>x86_64</td>
<td>docker，kube-apiserver，etcd，kube-scheduler，kube-controller-manager，kubelet，kube-proxy，coredns，calico</td>
<td>k8s master节点</td>
</tr>
<tr>
<td>k8scloude2/192.168.110.129</td>
<td>CentOS Linux release 7.4.1708 (Core)</td>
<td>x86_64</td>
<td>docker，kubelet，kube-proxy，calico</td>
<td>k8s worker节点</td>
</tr>
<tr>
<td>k8scloude3/192.168.110.128</td>
<td>CentOS Linux release 7.4.1708 (Core)</td>
<td>x86_64</td>
<td>docker，kubelet，kube-proxy，calico</td>
<td>k8s worker节点</td>
</tr>
</tbody>
</table></div>
<h1 id="二前言">二.前言<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>DevOps是一种将开发（Development）和运维（Operations）相结合的软件开发方法论。它通过自动化和持续交付的方式，将软件开发、测试和部署等环节紧密集成，以提高效率和产品质量。在本篇博客中，我们将介绍如何使用GitLab、Jenkins和Kubernetes(k8s)来构建一个完整的CI/CD解决方案。</p>
<p>使用GitLab、Jenkins和Kubernetes(k8s)来构建CI/CD解决方案的<strong>前提</strong>是已经有一套可以正常运行的Kubernetes集群，关于Kubernetes(k8s)集群的安装部署，可以查看博客《Centos7 安装部署Kubernetes(k8s)集群》<a href="https://www.cnblogs.com/renshengdezheli/p/16686769.html%E3%80%82" target="_blank">https://www.cnblogs.com/renshengdezheli/p/16686769.html。</a></p>
<h1 id="三devops简介">三.DevOps简介<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>DevOps通过打破开发和运维之间的壁垒，促进了更紧密的合作和快速响应变化的能力。它强调团队间的协作、自动化和持续改进。通过引入DevOps实践，组织可以更快地交付软件，并确保高质量的发布。</p>
<h1 id="四cicd简介">四.CI/CD简介<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>CI/CD代表持续集成（Continuous Integration）和持续交付（Continuous Delivery）。持续集成是指团队成员将其工作频繁地集成到共享存储库中，并进行自动化构建和测试，以减少集成问题。持续交付是指将应用程序更频繁地交付给用户，以便快速获得反馈并提供新功能。本次使用的CI/CD工具为Jenkins。</p>
<h1 id="五安装并配置docker参数">五.安装并配置docker参数<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>etcd1机器作为集成服务器，需要下载大量镜像，所以首先需要安装docker，docker版本标识：社区版 docker-ce 和企业版 docker-ee。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># yum -y install docker-ce</span>
</code></pre>
<p>为了让镜像下载速度变快，需要配置镜像加速器，关于docker更多详细内容，请查看博客《<a href="https://www.cnblogs.com/renshengdezheli/p/16628311.html" target="_blank">一文搞懂docker容器基础：docker镜像管理，docker容器管理</a>》。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/docker/daemon.json</span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/docker/daemon.json </span>
<span class="token punctuation">{</span>
<span class="token string">"registry-mirrors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"https://frz7i079.mirror.aliyuncs.com"</span><span class="token punctuation">]</span> 
<span class="token punctuation">}</span>
</code></pre>
<p>重启docker使配置生效。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl status docker</span>
● docker.service - Docker Application Container Engine
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/docker.service<span class="token punctuation">;</span> disabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since 六 <span class="token number">2022</span>-03-26 <span class="token number">17</span>:53:49 CST<span class="token punctuation">;</span> 40s ago
     Docs: https://docs.docker.com
 Main PID: <span class="token number">1495</span> <span class="token punctuation">(</span>dockerd<span class="token punctuation">)</span>
   Memory: <span class="token number">32</span>.9M
   CGroup: /system.slice/docker.service
           └─1495 /usr/bin/dockerd <span class="token parameter variable">-H</span> fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/run/containerd/containerd.sock
</code></pre>
<p>设置docker开机自启动</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable docker</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.
</code></pre>
<p>修改docker启动脚本，--insecure-registry=192.168.110.133:5000是镜像仓库的地址， 我们使用registry搭建镜像仓库，添加了--insecure-registry=192.168.110.133:5000参数之后，就可以使用http的方式拉取镜像，不然默认使用https的方式拉取镜像。</p>
<p>jenkins需要做的工作：构建，编译，推送，这些操作都需要借助docker去完成，但是jenkins自身是没有docker命令的，要让jenkins连接到物理机的docker上，需要添加参数：-H tcp://0.0.0.0:2376。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># vim /usr/lib/systemd/system/docker.service</span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># cat /usr/lib/systemd/system/docker.service</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/dockerd --insecure-registry<span class="token operator">=</span><span class="token number">192.168</span>.110.133:5000 <span class="token parameter variable">-H</span> tcp://0.0.0.0:2376  <span class="token parameter variable">-H</span> fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/run/containerd/containerd.sock
<span class="token punctuation">..</span><span class="token punctuation">..</span>.
</code></pre>
<p>重新加载配置文件，重启docker。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload ;systemctl restart docker</span>
</code></pre>
<p>查看状态可以发现：8083 /usr/bin/dockerd --insecure-registry=192.168.110.133:5000 -H tcp://0.0.0.0:2376 -H fd:// --containerd=/run/containerd/containerd.sock，修改参数成功。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl status docker</span>
● docker.service - Docker Application Container Engine
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/docker.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since 二 <span class="token number">2022</span>-03-29 <span class="token number">11</span>:37:51 CST<span class="token punctuation">;</span> 20s ago
     Docs: https://docs.docker.com
 Main PID: <span class="token number">8083</span> <span class="token punctuation">(</span>dockerd<span class="token punctuation">)</span>
   Memory: <span class="token number">36</span>.8M
   CGroup: /system.slice/docker.service
           └─8083 /usr/bin/dockerd --insecure-registry<span class="token operator">=</span><span class="token number">192.168</span>.110.133:5000 <span class="token parameter variable">-H</span> tcp://0.0.0.0:2376 <span class="token parameter variable">-H</span> fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/run/containerd/containerd.sock
</code></pre>
<p>我们把镜像推送到registry镜像仓库之后，k8s集群的worker节点会向registry镜像仓库拉取镜像，默认使用https的方式从镜像仓库拉取镜像，需要在k8s的worker节点修改docker启动参数，添加--insecure-registry=192.168.110.133:5000，让其使用http的方式从registry镜像仓库拉取镜像。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude2 ~<span class="token punctuation">]</span><span class="token comment"># vim /usr/lib/systemd/system/docker.service</span>

<span class="token punctuation">[</span>root@k8scloude2 ~<span class="token punctuation">]</span><span class="token comment"># cat /usr/lib/systemd/system/docker.service</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/dockerd --insecure-registry<span class="token operator">=</span><span class="token number">192.168</span>.110.133:5000  <span class="token parameter variable">-H</span> fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/run/containerd/containerd.sock
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>

<span class="token punctuation">[</span>root@k8scloude2 ~<span class="token punctuation">]</span><span class="token comment"># grep ExecStart /usr/lib/systemd/system/docker.service</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/dockerd --insecure-registry<span class="token operator">=</span><span class="token number">192.168</span>.110.133:5000  <span class="token parameter variable">-H</span> fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/run/containerd/containerd.sock
</code></pre>
<p>重新加载配置文件，重启docker。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude2 ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload ;systemctl restart docker</span>

<span class="token punctuation">[</span>root@k8scloude2 ~<span class="token punctuation">]</span><span class="token comment"># systemctl status docker</span>
● docker.service - Docker Application Container Engine
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/docker.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since 二 <span class="token number">2022</span>-03-29 <span class="token number">11</span>:51:36 CST<span class="token punctuation">;</span> 4s ago
     Docs: https://docs.docker.com
 Main PID: <span class="token number">57510</span> <span class="token punctuation">(</span>dockerd<span class="token punctuation">)</span>
   Memory: <span class="token number">63</span>.6M
   CGroup: /system.slice/docker.service
           ├─57510 /usr/bin/dockerd --insecure-registry<span class="token operator">=</span><span class="token number">192.168</span>.110.133:5000 <span class="token parameter variable">-H</span> fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/run/containerd/containerd.sock
           ├─57759 /usr/bin/docker-proxy <span class="token parameter variable">-proto</span> tcp -host-ip <span class="token number">0.0</span>.0.0 -host-port <span class="token number">80</span> -container-ip <span class="token number">172.17</span>.0.2 -container-port <span class="token number">80</span>
           └─57767 /usr/bin/docker-proxy <span class="token parameter variable">-proto</span> tcp -host-ip :: -host-port <span class="token number">80</span> -container-ip <span class="token number">172.17</span>.0.2 -container-port <span class="token number">80</span>
</code></pre>
<p>k8scloude3节点也需要修改docker启动参数，添加--insecure-registry=192.168.110.133:5000，让其使用http的方式从registry镜像仓库拉取镜像。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude3 ~<span class="token punctuation">]</span><span class="token comment"># vim /usr/lib/systemd/system/docker.service</span>

<span class="token punctuation">[</span>root@k8scloude3 ~<span class="token punctuation">]</span><span class="token comment"># grep ExecStart /usr/lib/systemd/system/docker.service</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/dockerd --insecure-registry<span class="token operator">=</span><span class="token number">192.168</span>.110.133:5000  <span class="token parameter variable">-H</span> fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/run/containerd/containerd.sock
</code></pre>
<p>重新加载配置文件，重启docker。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude3 ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload ;systemctl restart docker</span>

<span class="token punctuation">[</span>root@k8scloude3 ~<span class="token punctuation">]</span><span class="token comment"># systemctl status docker</span>
● docker.service - Docker Application Container Engine
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/docker.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since 二 <span class="token number">2022</span>-03-29 <span class="token number">15</span>:55:13 CST<span class="token punctuation">;</span> 5s ago
     Docs: https://docs.docker.com
 Main PID: <span class="token number">9099</span> <span class="token punctuation">(</span>dockerd<span class="token punctuation">)</span>
   Memory: <span class="token number">43</span>.1M
   CGroup: /system.slice/docker.service
           └─9099 /usr/bin/dockerd --insecure-registry<span class="token operator">=</span><span class="token number">192.168</span>.110.133:5000 <span class="token parameter variable">-H</span> fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/run/containerd/containerd.sock
</code></pre>
<p>现在k8s集群的所有worker节点都加上了--insecure-registry=192.168.110.133:5000参数。</p>
<p>在etcd1机器拉取nginx镜像，之后做web容器的时候会用到。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker pull nginx</span>
Using default tag: latest
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Status: Downloaded newer image <span class="token keyword">for</span> nginx:latest
docker.io/library/nginx:latest

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker images | grep nginx</span>
nginx                            latest                605c77e624dd   <span class="token number">3</span> months ago   141MB
</code></pre>
<h1 id="六使用registry搭建镜像仓库">六.使用registry搭建镜像仓库<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>本次使用registry搭建镜像仓库，也可以使用harbor搭建镜像仓库，功能更丰富，关于harbor的详细内容，请查看博客《<a href="https://www.cnblogs.com/renshengdezheli/p/16660989.html" target="_blank">搭建docker镜像仓库(二)：使用harbor搭建本地镜像仓库</a>》。</p>
<p>拉取registry镜像</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker pull hub.c.163.com/library/registry:latest      </span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker images | grep registry</span>
hub.c.163.com/library/registry   latest                751f286bc25e   <span class="token number">4</span> years ago    <span class="token number">33</span>.2MB
</code></pre>
<p>注意：registry的数据卷为：VOLUME [/var/lib/registry]，不能是其他的。</p>
<p>创建registry容器，registry镜像生成容器作为私有仓库，-p 5000:5000做端口映射，物理机端口5000:容器端口5000，<br>
-v /myregistry:/var/lib/registry数据卷挂载，物理机目录/myregistry:容器目录/var/lib/registry。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d --name registry -p 5000:5000 --restart=always -v /myregistry:/var/lib/registry hub.c.163.com/library/registry</span>
3aa799d1974611fc403ce38aa19a156cb165a82573b84b16fde665d9e3b62eb0
</code></pre>
<p>现在registry镜像仓库就搭建好了。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker ps | grep registry</span>
3aa799d19746   hub.c.163.com/library/registry   <span class="token string">"/entrypoint.sh /etc…"</span>   <span class="token number">8</span> seconds ago   Up <span class="token number">7</span> seconds           <span class="token number">0.0</span>.0.0:5000-<span class="token operator">&gt;</span><span class="token number">5000</span>/tcp, :::5000-<span class="token operator">&gt;</span><span class="token number">5000</span>/tcp                                                                         registry
</code></pre>
<p>此时镜像仓库下还没有任何文件</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># ls /myregistry/</span>
</code></pre>
<h1 id="七安装部署gitlab代码仓库">七.安装部署gitlab代码仓库<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<h2 id="71-创建gitlab容器">7.1 创建gitlab容器<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>在etcd1机器下载gitlab中文版镜像</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker pull beginor/gitlab-ce     </span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker images | grep gitlab</span>
beginor/gitlab-ce                latest                5595d4ff803e   <span class="token number">3</span> years ago    <span class="token number">1</span>.5GB
</code></pre>
<p>创建gitlab配置文件目录，日志目录，代码目录</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /data/gitlab/etc /data/gitlab/log /data/gitlab/data   </span>
</code></pre>
<p>给gitlab配置文件目录，日志目录，代码目录授予777权限</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># chmod 777 /data/gitlab/etc /data/gitlab/log /data/gitlab/data   </span>
</code></pre>
<p>创建gitlab容器，使用--privileged=true参数，使container内的root拥有真正的root权限。否则，container内的root只是外部的一个普通用户权限。--privileged=true启动的容器，可以看到很多host上的设备，并且可以执行mount。甚至允许你在docker容器中启动docker容器。</p>
<p>-v指定数据卷，gitlab容器的配置文件，日志文件，数据文件也都存储到了物理机上，我们修改对应数据卷的内容，gitlab容器的相关内容也随之改变。-p指定端口映射。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker run -dit --name=gitlab --restart=always -p 8443:443 -p 80:80 -p 222:22 -v /data/gitlab/etc:/etc/gitlab -v /data/gitlab/log:/var/log/gitlab -v /data/gitlab/data:/var/opt/gitlab --privileged=true beginor/gitlab-ce      </span>
</code></pre>
<p>查看gitlab容器</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker ps | grep gitlab</span>
d23f2df47e42   beginor/gitlab-ce                <span class="token string">"/assets/wrapper"</span>        <span class="token number">22</span> hours ago    Up <span class="token number">6</span> hours <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   <span class="token number">0.0</span>.0.0:80-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::80-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, <span class="token number">0.0</span>.0.0:222-<span class="token operator">&gt;</span><span class="token number">22</span>/tcp, :::222-<span class="token operator">&gt;</span><span class="token number">22</span>/tcp, <span class="token number">0.0</span>.0.0:8443-<span class="token operator">&gt;</span><span class="token number">443</span>/tcp, :::8443-<span class="token operator">&gt;</span><span class="token number">443</span>/tcp   gitlab
</code></pre>
<p>现在gitlab配置文件目录，日志目录，代码目录都有相关文件了。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># ls /data/gitlab/etc/</span>
gitlab.rb  gitlab-secrets.json  ssh_host_ecdsa_key  ssh_host_ecdsa_key.pub  ssh_host_ed25519_key  ssh_host_ed25519_key.pub  ssh_host_rsa_key  ssh_host_rsa_key.pub  trusted-certs

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># ls /data/gitlab/log/</span>
gitaly  gitlab-monitor  gitlab-rails  gitlab-shell  gitlab-workhorse  <span class="token function">logrotate</span>  nginx  node-exporter  postgres-exporter  postgresql  prometheus  reconfigure  redis  redis-exporter  sidekiq  sshd  unicorn

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># ls /data/gitlab/data/</span>
backups       gitaly    gitlab-ci       gitlab-rails  gitlab-workhorse  nginx          postgres-exporter  prometheus              redis
bootstrapped  git-data  gitlab-monitor  gitlab-shell  <span class="token function">logrotate</span>         node-exporter  postgresql         public_attributes.json  trusted-certs-directory-hash
</code></pre>
<h2 id="72-修改gitlab容器配置文件">7.2 修改gitlab容器配置文件<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>注意先让gitlab容器运行一段时间，让其数据进行初始化，然后再停止gitlab容器，修改配置文件。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker stop gitlab   </span>
</code></pre>
<p>下面开始修改gitlab的配置文件。</p>
<p>修改/data/gitlab/etc/gitlab.rb，external_url指的是gitlab所在的机器IP，gitlab_ssh_host指定gitlab所在的机器IP，gitlab_shell_ssh_port指定ssh端口，因为我们把gitlab容器的22端口映射为了222，所以gitlab_shell_ssh_port为222。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># vim /data/gitlab/etc/gitlab.rb   </span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># cat /data/gitlab/etc/gitlab.rb | egrep -v "^#" | egrep "external_url|gitlab_ssh_host|ssh_port"</span>
external_url <span class="token string">'http://192.168.110.133'</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_ssh_host'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'192.168.110.133'</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_shell_ssh_port'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">222</span>
</code></pre>
<p>修改/data/gitlab/data/gitlab-rails/etc/gitlab.yml，host指定gitlab所在的机器IP，端口为80，不使用https。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># vim /data/gitlab/data/gitlab-rails/etc/gitlab.yml   </span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># grep -A6 192.168.110.133 /data/gitlab/data/gitlab-rails/etc/gitlab.yml</span>
    host: <span class="token number">192.168</span>.110.133
    port: <span class="token number">80</span>
    https: <span class="token boolean">false</span>
</code></pre>
<p>启动gitlab容器。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker start gitlab   </span>
</code></pre>
<p>查看gitlab容器。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker ps | grep gitlab</span>
d23f2df47e42   beginor/gitlab-ce                <span class="token string">"/assets/wrapper"</span>        <span class="token number">22</span> hours ago     Up <span class="token number">6</span> hours <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   <span class="token number">0.0</span>.0.0:80-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::80-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, <span class="token number">0.0</span>.0.0:222-<span class="token operator">&gt;</span><span class="token number">22</span>/tcp, :::222-<span class="token operator">&gt;</span><span class="token number">22</span>/tcp, <span class="token number">0.0</span>.0.0:8443-<span class="token operator">&gt;</span><span class="token number">443</span>/tcp, :::8443-<span class="token operator">&gt;</span><span class="token number">443</span>/tcp   gitlab
</code></pre>
<h2 id="73-访问gitlab-web界面">7.3 访问gitlab web界面<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>浏览器访问gitlab所在机器的IP地址和80端口，即可访问gitlab web界面 。</p>
<p>访问gitlab界面http://192.168.110.133/，gitlab登录界面如下。</p>
<p><img src="./k8s_files/image-20230626154741485.png" alt="image-20230626154741485" loading="lazy" class="medium-zoom-image"></p>
<p>点击修改密码，注意密码如果太简单会报错。</p>
<p><img src="./k8s_files/image-20230626154833734.png" alt="image-20230626154833734" loading="lazy" class="medium-zoom-image"></p>
<p>设置账号密码：账号为root，密码为：mycoderepo123。</p>
<p><img src="./k8s_files/image-20230626154911591.png" alt="image-20230626154911591" loading="lazy" class="medium-zoom-image"></p>
<p>输入账号root，密码：mycoderepo123登录gitlab界面。</p>
<p><img src="./k8s_files/image-20230626154948671.png" alt="image-20230626154948671" loading="lazy" class="medium-zoom-image"></p>
<p>登录gitlab之后，首页如下。</p>
<p><img src="./k8s_files/image-20230626155040160.png" alt="image-20230626155040160" loading="lazy" class="medium-zoom-image"></p>
<p>可以看到gitlab版本为：GitLab 社区版 10.7.5。</p>
<p><img src="./k8s_files/image-20230626155126193.png" alt="image-20230626155126193" loading="lazy" class="medium-zoom-image"></p>
<h2 id="74-创建项目">7.4 创建项目<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>点击创建一个项目。</p>
<p><img src="./k8s_files/image-20230626155227593.png" alt="image-20230626155227593" loading="lazy" class="medium-zoom-image"></p>
<p>设置项目名称为：my-project，项目描述（可选），可见等级设置为公开，点击创建项目。</p>
<p><img src="./k8s_files/image-20230626155302684.png" alt="image-20230626155302684" loading="lazy" class="medium-zoom-image"></p>
<p>选择SSH的方式拉取和推送代码，点击新建SSH公钥，否则无法通过SSH拉取和推送代码。</p>
<p><img src="./k8s_files/image-20230626173823550.png" alt="image-20230626173823550" loading="lazy" class="medium-zoom-image"></p>
<p>需要粘贴SSH的公钥，现在去代码上传的机器上拿密钥。</p>
<p><img src="./k8s_files/image-20230626173908189.png" alt="image-20230626173908189" loading="lazy" class="medium-zoom-image"></p>
<p>现在回到etcd1机器，创建SSH密钥，复制公钥信息到Gitlab的密钥里。</p>
<p>现在还没有SSH密钥。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># ls ~/.ssh/</span>
 known_hosts
</code></pre>
<p>生成密钥，-N ""表示提供一个新密语，密语为空。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen -N ""   </span>
</code></pre>
<p>查看生成的密钥，id_rsa是私钥 ，id_rsa.pub是公钥。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># ls ~/.ssh/</span>
id_rsa  id_rsa.pub  known_hosts
</code></pre>
<p>查看公钥，并复制公钥信息到Gitlab的密钥里。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># cat ~/.ssh/id_rsa.pub</span>
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDDGO+hg4j5pkEN/VrD/OOHFkEWvpyAYSmLnCL35MHnqSSshJA29ZPmBNByIMSTnhHU9j2oQ6RSh8YIgULnf8T7aQ+/ByTojhenbXjI7l47NkmWDVLE89rHY+fxWIy21sXrQLUNivbxfV+drQ47Kts4+PkeXxPpfFCjqPlk5VMQdSQGe9IvFUFKb46ctyzClUlXp1dGQbLHZaeZ/KzpCavRxvXRUECO8dCItoI1jFtLFy/+1uyXDLNe/38nwJuwa6J/KWAYB7gRwrRITvdOn+4L+iJFK5MPI6evdN6ZzGUTGkr3BgufrDpV3Tk0CMdAfNDvOfu2sg7mey4OiT+zvLn9 root@etcd1
</code></pre>
<p>复制公钥信息到Gitlab的密钥里，点击添加密钥。</p>
<p><img src="./k8s_files/image-20230626174033868.png" alt="image-20230626174033868" loading="lazy" class="medium-zoom-image"></p>
<p>添加密钥之后如下。</p>
<p><img src="./k8s_files/image-20230626174110717.png" alt="image-20230626174110717" loading="lazy" class="medium-zoom-image"></p>
<h2 id="75-创建git版本库">7.5 创建Git版本库<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>点击项目---&gt;您的项目。</p>
<p><img src="./k8s_files/image-20230626174145261.png" alt="image-20230626174145261" loading="lazy" class="medium-zoom-image"></p>
<p>找到我们的项目，点击进入。</p>
<p><img src="./k8s_files/image-20230626174221850.png" alt="image-20230626174221850" loading="lazy" class="medium-zoom-image"></p>
<p>根据命令行指令创建Git版本库。</p>
<p><img src="./k8s_files/image-20230626174301072.png" alt="image-20230626174301072" loading="lazy" class="medium-zoom-image"></p>
<p>安装Git</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># yum -y install git    </span>
</code></pre>
<p>--global表示Git 全局设置，设置用户名和邮箱。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># git config --global user.name "Administrator"   </span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># git config --global user.email "lizedemail@foxmail.com"    </span>
</code></pre>
<p>把我们gitlab上的项目克隆下来。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># git clone ssh://git@192.168.110.133:222/root/my-project.git     </span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># ls my-project/</span>
index.html
</code></pre>
<p>修改index.html首页文件。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># cd my-project/</span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># vim index.html</span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># cat index.html</span>
hello gitlab
</code></pre>
<p>在Git 1.0 中，git push 默认会把你本地的所有分支都上传到远程， push.default 的值是‘matching’，如果想始终保持以往的习惯就执行</p>
<p>git config --global push.default matching。</p>
<p>到了git 2.0，git push默认是把当前分支上传到远程而不是所有本地分支，push.default 的值是‘simple’，这样比较保守也推荐这样，git config --global push.default simple。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git config --global push.default matching   </span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git config --global push.default simple   </span>
</code></pre>
<p>git add 命令可将该文件添加到暂存区。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git add index.html  </span>
</code></pre>
<p>添加注释</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git commit -m "add index.html"   </span>
</code></pre>
<p>git push命令用于将本地分支的更新，推送到远程主机。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git push   </span>
</code></pre>
<p>去gitlab界面上看文件是否推送过去，可以看到index.html被推送到gitlab代码仓库了。</p>
<p><img src="./k8s_files/image-20230626174446591.png" alt="image-20230626174446591" loading="lazy" class="medium-zoom-image"></p>
<p>自此gitlab代码仓库配置完成，但是还缺触发jenkins，等安装好jenkins再配置。</p>
<h1 id="八安装部署cicd服务器jenkins">八.安装部署CI/CD服务器jenkins<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<h2 id="81-创建jenkins容器">8.1 创建jenkins容器<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>拉取网易的jenkins镜像。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker pull hub.c.163.com/library/jenkins:latest   </span>
</code></pre>
<p>下载基于centos的jenkins镜像。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker pull jenkins/jenkins:2.332.1-lts-centos7   </span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker images | grep jenkins</span>
jenkins/jenkins                  <span class="token number">2.332</span>.1-lts-centos7   0dfc0feff986   <span class="token number">2</span> weeks ago    503MB
hub.c.163.com/library/jenkins    latest                88d9d8a30b47   <span class="token number">4</span> years ago    810MB
</code></pre>
<p>创建jenkins数据卷所需要的目录，并把所有者和所属组改为1000。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># mkdir /jenkins ; chown 1000:1000 /jenkins   </span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># ll -d /jenkins/</span>
drwxr-xr-x <span class="token number">12</span> tom tom <span class="token number">4096</span> <span class="token number">3</span>月  <span class="token number">30</span> <span class="token number">15</span>:59 /jenkins/
</code></pre>
<p>/jenkins的属主UID要改成1000的原因为：容器里是以jenkins用户的身份去读写数据，而在容器里 jenkins 的 uid 是 1000，可以看下此镜像的 Dockerfile 内容。</p>
<p>通过jenkins镜像的Dockerfile可以发现，用户UID和用户组GID为1000，HTTP端口为8080，代理端口为50000。</p>
<p><img src="./k8s_files/image-20230626174656834.png" alt="image-20230626174656834" loading="lazy" class="medium-zoom-image"></p>
<p>创建jenkins容器。</p>
<ul>
<li>-dit: 在后台以交互模式运行容器，并分配一个伪终端。</li>
<li>-p 8080:8080: 将主机的8080端口映射到容器的8080端口，允许通过主机的8080端口访问Jenkins的Web界面。</li>
<li>-p 50000:50000: 将主机的50000端口映射到容器的50000端口，用于Jenkins的代理节点通信。</li>
<li>--name jenkins: 指定容器的名称为"jenkins"。</li>
<li>--privileged=true: 启用特权模式，允许容器内部的进程拥有更高级别的权限。</li>
<li>--restart=always: 定义容器在退出或重启之后应该自动重新启动。</li>
<li>-v /jenkins:/var/jenkins_home: 将主机上的"/jenkins"目录挂载到容器内部的"/var/jenkins_home"目录，用于持久化Jenkins数据。</li>
</ul>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker run -dit -p 8080:8080 -p 50000:50000 --name jenkins --privileged=true --restart=always -v /jenkins:/var/jenkins_home jenkins/jenkins:2.332.1-lts-centos7   </span>
</code></pre>
<h2 id="82-修改jenkins配置文件">8.2 修改Jenkins配置文件<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>让jenkins容器运行一段时间之后，再访问jenkins web界面，浏览器访问:192.168.110.133:8080，即可访问jenkins的web界面，Jenkins登录界面如下：</p>
<p><img src="./k8s_files/image-20230626174849742.png" alt="image-20230626174849742" loading="lazy" class="medium-zoom-image"></p>
<p>下面需要修改jenkins容器的配置文件，因为jenkins容器使用了数据卷：-v /jenkins:/var/jenkins_home，我们修改物理机/jenkins下面的文件，对应容器里的文件也就相应改变。</p>
<p>先停止容器，再修改配置文件。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker stop jenkins   </span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker ps -a | grep jenkins</span>
99b1d931eaf4   jenkins/jenkins:2.332.1-lts-centos7   <span class="token string">"/sbin/tini -- /usr/…"</span>   <span class="token number">5</span> hours ago      Exited <span class="token punctuation">(</span><span class="token number">143</span><span class="token punctuation">)</span> About an hour ago                                                                                                                     jenkins
</code></pre>
<p>查看/jenkins/hudson.model.UpdateCenter.xml内容。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># ls /jenkins/</span>
config.xml               hudson.model.UpdateCenter.xml  jenkins.telemetry.Correlator.xml  nodeMonitors.xml  plugins     secret.key.not-so-secret  updates      <span class="token function">users</span>
copy_reference_file.log  identity.key.enc               <span class="token function">jobs</span>                              nodes             secret.key  secrets                   userContent  war

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># cat /jenkins/hudson.model.UpdateCenter.xml</span>
<span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">'1.1'</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">'UTF-8'</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>sites<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>site<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>https://updates.jenkins.io/update-center.json<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/site<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/sites<span class="token operator">&gt;</span>
</code></pre>
<p><strong><url><a href="https://updates.jenkins.io/update-center.json" target="_blank" rel="noopener nofollow">https://updates.jenkins.io/update-center.json</a></url></strong>这个地址是用来更新jenkins和安装jenkins插件的网址，把该地址换为清华大学的地址，提高安装jenkins插件的下载速度。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># vim /jenkins/hudson.model.UpdateCenter.xml</span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># cat /jenkins/hudson.model.UpdateCenter.xml</span>
<span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">'1.1'</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">'UTF-8'</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>sites<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>site<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>http://mirrors.tuna.tsinghua.edu.cn/jenkins<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/site<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/sites<span class="token operator">&gt;</span>
</code></pre>
<p>/jenkins/updates/default.json文件的connectionCheckUrl修改为："connectionCheckUrl":"<a href="http://www.baidu.com/" target="_blank" rel="noopener nofollow">http://www.baidu.com/</a>"    。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># ll /jenkins/updates/default.json -h</span>
-rw-r--r-- <span class="token number">1</span> tom tom <span class="token number">2</span>.5M <span class="token number">3</span>月  <span class="token number">30</span> <span class="token number">16</span>:04 /jenkins/updates/default.json

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># vim /jenkins/updates/default.json</span>
</code></pre>
<p>启动Jenkins。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker start jenkins </span>
jenkins

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker ps | grep jenkins</span>
99b1d931eaf4   jenkins/jenkins:2.332.1-lts-centos7   <span class="token string">"/sbin/tini -- /usr/…"</span>   <span class="token number">5</span> hours ago      Up <span class="token number">9</span> seconds           <span class="token number">0.0</span>.0.0:8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, :::8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, <span class="token number">0.0</span>.0.0:50000-<span class="token operator">&gt;</span><span class="token number">50000</span>/tcp, :::50000-<span class="token operator">&gt;</span><span class="token number">50000</span>/tcp                          jenkins
</code></pre>
<h2 id="83-查看jenkins管理员密码并登录">8.3 查看jenkins管理员密码并登录<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>刷新jenkins web页面，登录Jenkins需要管理员密码。</p>
<p><img src="./k8s_files/image-20230626175103200.png" alt="image-20230626175103200" loading="lazy" class="medium-zoom-image"></p>
<p>jenkins管理员密码在/jenkins/secrets/initialAdminPassword文件，查看密码。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true" has-selection="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># cat /jenkins/secrets/initialAdminPassword </span>
542e9af5e55f4543ae4fefee8bdd2d3c
</code></pre>
<p>把密码复制到jenkins页面。</p>
<p><img src="./k8s_files/image-20230626175253650.png" alt="image-20230626175253650" loading="lazy" class="medium-zoom-image"></p>
<h2 id="84-安装jenkins插件">8.4 安装Jenkins插件<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>点击安装推荐的插件。</p>
<p><img src="./k8s_files/image-20230626175330327.png" alt="image-20230626175330327" loading="lazy" class="medium-zoom-image"></p>
<p>现在插件就开始安装了。</p>
<p><img src="./k8s_files/image-20230626175412733.png" alt="image-20230626175412733" loading="lazy" class="medium-zoom-image"></p>
<p>部分插件安装失败之后点击重试。</p>
<p><img src="./k8s_files/image-20230626175443809.png" alt="image-20230626175443809" loading="lazy" class="medium-zoom-image"></p>
<p>Jenkins插件安装完成之后，会出现创建管理员用户界面。</p>
<p><img src="./k8s_files/image-20230626175521262.png" alt="image-20230626175521262" loading="lazy" class="medium-zoom-image"></p>
<p>创建管理员用户：用户名:jenkinsadmin    密码：devopsjenkins123  全名:jenkinsadmin   电子邮箱地址：<a href="mailto:lizedemail@foxmail.com" target="_blank" rel="noopener nofollow">mailto:lizedemail@foxmail.com</a>。点击保存并完成</p>
<p><img src="./k8s_files/image-20230626175613180.png" alt="image-20230626175613180" loading="lazy" class="medium-zoom-image"></p>
<p>实例配置：Jenkins URL 用于给各种Jenkins资源提供绝对路径链接的根地址，Jenkins URL:<a href="http://192.168.110.133:8080/%EF%BC%8C%E7%82%B9%E5%87%BB%E4%BF%9D%E5%AD%98%E5%B9%B6%E5%AE%8C%E6%88%90%E3%80%82" target="_blank" rel="noopener nofollow">http://192.168.110.133:8080/，点击保存并完成。</a></p>
<p><img src="./k8s_files/image-20230626175656556.png" alt="image-20230626175656556" loading="lazy" class="medium-zoom-image"></p>
<p>此时jenkins就安装完成了，点击开始使用。</p>
<p><img src="./k8s_files/image-20230626175726106.png" alt="image-20230626175726106" loading="lazy" class="medium-zoom-image"></p>
<p>jenkins主界面如下：</p>
<p><img src="./k8s_files/image-20230626180720559.png" alt="image-20230626180720559" loading="lazy" class="medium-zoom-image"></p>
<p>有些插件没安装成功，点击纠正。</p>
<p><img src="./k8s_files/image-20230626180750858.png" alt="image-20230626180750858" loading="lazy" class="medium-zoom-image"></p>
<p>点击立即获取。</p>
<p><img src="./k8s_files/image-20230626180836386.png" alt="image-20230626180836386" loading="lazy" class="medium-zoom-image"></p>
<p>报错了，但是不影响，我们继续。</p>
<p><img src="./k8s_files/image-20230626180925885.png" alt="image-20230626180925885" loading="lazy" class="medium-zoom-image"></p>
<p>jenkins需要连接我们物理机的docker，然后编译构建镜像，把镜像推送到registry仓库，所以jenkins需要安装docker插件，在jenkins主页依次点击manage jenkins--&gt;Manage Plugins--&gt;可选插件，搜索docker，选择 docker 和 docker-build-step安装。</p>
<p><img src="./k8s_files/image-20230626181025229.png" alt="image-20230626181025229" loading="lazy" class="medium-zoom-image"></p>
<p>选中安装完成后重启jenkins（空闲时）。</p>
<p><img src="./k8s_files/image-20230626181100303.png" alt="image-20230626181100303" loading="lazy" class="medium-zoom-image"></p>
<p>在Jenkins web页面重启jenkins太慢了，我们手动重启jenkins。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker restart jenkins </span>
jenkins

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># docker ps | grep jenkins</span>
99b1d931eaf4   jenkins/jenkins:2.332.1-lts-centos7   <span class="token string">"/sbin/tini -- /usr/…"</span>   <span class="token number">7</span> hours ago    Up <span class="token number">12</span> seconds          <span class="token number">0.0</span>.0.0:8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, :::8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, <span class="token number">0.0</span>.0.0:50000-<span class="token operator">&gt;</span><span class="token number">50000</span>/tcp, :::50000-<span class="token operator">&gt;</span><span class="token number">50000</span>/tcp                          jenkins
</code></pre>
<p>刷新jenkins页面重新登录，用户名:jenkinsadmin    密码：devopsjenkins123。</p>
<p><img src="./k8s_files/image-20230626181310710.png" alt="image-20230626181310710" loading="lazy" class="medium-zoom-image"></p>
<p>在jenkins主页依次点击系统管理--&gt;插件管理--&gt;已安装，搜索docker，发现 docker 插件和 docker-build-step插件已经安装好了。</p>
<p><img src="./k8s_files/image-20230626181542940.png" alt="image-20230626181542940" loading="lazy" class="medium-zoom-image"></p>
<h2 id="85-配置jenkins连接docker">8.5 配置Jenkins连接docker<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>在首页依次点击系统管理--&gt;节点管理--&gt;configure Clouds，Add a new cloud选择Docker。</p>
<p><img src="./k8s_files/image-20230626181625786.png" alt="image-20230626181625786" loading="lazy" class="medium-zoom-image"></p>
<p>点击Docker Cloud details。</p>
<p><img src="./k8s_files/image-20230626181706568.png" alt="image-20230626181706568" loading="lazy" class="medium-zoom-image"></p>
<p>Docker Host URI输入连接docker的地址，此处为：tcp://192.168.110.133:2376，再点击test connection，如果出现docker的版本号，则jenkins连接docker成功，最后保存即可。</p>
<p><img src="./k8s_files/image-20230626181810051.png" alt="image-20230626181810051" loading="lazy" class="medium-zoom-image"></p>
<p>在首页点击系统管理--&gt;系统配置，找到 Docker Builder，在docker URL里输入连接的docker地址：tcp://192.168.110.133:2376，点击 test connection，如果出现Connected to tcp://192.168.110.133:2376，这样说明jenkins和docker就关联起来了，最后点击保存。</p>
<p><img src="./k8s_files/image-20230626181848790.png" alt="image-20230626181848790" loading="lazy" class="medium-zoom-image"></p>
<p>此时jenkins就能连接docker了。</p>
<h2 id="86-安全设置">8.6 安全设置<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>gitlab要触发jenkins操作，需要做相关安全设置，首页依次点击系统管理--&gt;全局安全配置--&gt;授权策略，勾选"匿名用户具有可读权限"。</p>
<p><img src="./k8s_files/image-20230626181937576.png" alt="image-20230626181937576" loading="lazy" class="medium-zoom-image"></p>
<p>注意下面的<code>跨站请求伪造保护(CSFR)</code>必须要关闭，但是在Jenkins版本自2.2xx版本之后，在 web 界面里已经没法关闭了，所以在当前 web 界面里暂且不要管它，点击下面的保存。</p>
<p><img src="./k8s_files/image-20230626182051092.png" alt="image-20230626182051092" loading="lazy" class="medium-zoom-image"></p>
<p>gitlab 要触发 jenkins 的话，就必须要关闭跨站请求伪造保护，既然web 界面里已经没法关闭了，那么我们在命令行里操作。</p>
<p>查看Jenkins容器，可以发现jenkins容器运行着/usr/local/bin/jenkins.sh脚本。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a | grep  jenkins </span>
<span class="token environment constant">UID</span>                 PID                 <span class="token environment constant">PPID</span>                C                   STIME               TTY                 TIME                CMD
tom                 <span class="token number">1590</span>                <span class="token number">1535</span>                <span class="token number">0</span>                   <span class="token number">3</span>月30                pts/0               00:00:00            /sbin/tini -- /usr/local/bin/jenkins.sh
tom                 <span class="token number">1682</span>                <span class="token number">1590</span>                <span class="token number">2</span>                   <span class="token number">3</span>月30                pts/0               00:04:51            <span class="token function">java</span> <span class="token parameter variable">-Duser.home</span><span class="token operator">=</span>/var/jenkins_home <span class="token parameter variable">-Djenkins.model.Jenkins.slaveAgentPort</span><span class="token operator">=</span><span class="token number">50000</span> <span class="token parameter variable">-jar</span> /usr/share/jenkins/jenkins.war
</code></pre>
<p>进入jenkins容器。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -u root -it jenkins bash </span>

<span class="token comment">#/usr/local/bin/jenkins.sh脚本中的exec java -Duser.home参数如下，我们需要修改exec java -Duser.home的值</span>
<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># egrep "exec java -Duser.home=" /usr/local/bin/jenkins.sh</span>
  <span class="token builtin class-name">exec</span> <span class="token function">java</span> <span class="token parameter variable">-Duser.home</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$JENKINS_HOME</span>"</span> <span class="token variable">${FUTURE_OPTS}</span> <span class="token string">"<span class="token variable">${java_opts_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token parameter variable">-jar</span> <span class="token variable">${JENKINS_WAR}</span> <span class="token string">"<span class="token variable">${jenkins_opts_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token string">"<span class="token variable">$@</span>"</span>

<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># vi /usr/local/bin/jenkins.sh</span>

<span class="token comment">#修改后，exec java -Duser.home的值如下：</span>
<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># egrep "exec java -Duser.home=" /usr/local/bin/jenkins.sh</span>
  <span class="token builtin class-name">exec</span> <span class="token function">java</span> <span class="token parameter variable">-Duser.home</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$JENKINS_HOME</span>"</span> <span class="token parameter variable">-Dhudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION</span><span class="token operator">=</span>true  <span class="token variable">${FUTURE_OPTS}</span> <span class="token string">"<span class="token variable">${java_opts_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token parameter variable">-jar</span> <span class="token variable">${JENKINS_WAR}</span> <span class="token string">"<span class="token variable">${jenkins_opts_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token string">"<span class="token variable">$@</span>"</span>

<span class="token comment">#退出jenkins容器</span>
<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
</code></pre>
<p>重启Jenkins，使配置文件生效。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker restart jenkins </span>
jenkins

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker ps | grep jenkins</span>
99b1d931eaf4   jenkins/jenkins:2.332.1-lts-centos7   <span class="token string">"/sbin/tini -- /usr/…"</span>   <span class="token number">13</span> hours ago   Up <span class="token number">10</span> seconds           <span class="token number">0.0</span>.0.0:8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, :::8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, <span class="token number">0.0</span>.0.0:50000-<span class="token operator">&gt;</span><span class="token number">50000</span>/tcp, :::50000-<span class="token operator">&gt;</span><span class="token number">50000</span>/tcp                          jenkins
</code></pre>
<p>重启好jenkins之后，登录jenkins web界面。</p>
<p>首页依次点击系统管理--&gt;全局安全配置，此时跨站请求伪造保护已经被关闭了。</p>
<p><img src="./k8s_files/image-20230626182250789.png" alt="image-20230626182250789" loading="lazy" class="medium-zoom-image"></p>
<h2 id="87-配置jenkins连接kubernetesk8s集群">8.7 配置Jenkins连接Kubernetes(k8s)集群<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>jenkins需要把镜像部署到Kubernetes(k8s)集群，所以jenkins需要kubectl客户端工具和kubeconfig文件连接k8s环境，现在回到Kubernetes(k8s)集群。</p>
<p>查看kubectl的版本号。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># rpm -qa | grep kubectl</span>
kubectl-1.21.0-0.x86_64
</code></pre>
<p>直接拷贝一个kubectl文件到Jenkins所在服务器。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># scp /usr/bin/kubectl 192.168.110.133:~/</span>
root@192.168.110.133's password: 
kubectl                                                           
</code></pre>
<p>或者直接下载一个kubectl文件也可以。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># wget https://storage.googleapis.com/kubernetes-release/release/v1.21.0/bin/linux/amd64/kubectl</span>
--2022-03-31 01:13:11--  https://storage.googleapis.com/kubernetes-release/release/v1.21.0/bin/linux/amd64/kubectl
正在解析主机 storage.googleapis.com <span class="token punctuation">(</span>storage.googleapis.com<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">142.251</span>.43.16, <span class="token number">172.217</span>.163.48, <span class="token number">142.251</span>.42.240, <span class="token punctuation">..</span>.
正在连接 storage.googleapis.com <span class="token punctuation">(</span>storage.googleapis.com<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">142.251</span>.43.16<span class="token operator">|</span>:443<span class="token punctuation">..</span>. 已连接。
已发出 HTTP 请求，正在等待回应<span class="token punctuation">..</span>. <span class="token number">200</span> OK
长度：46436352 <span class="token punctuation">(</span>44M<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
正在保存至: “kubectl.1”

<span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token number">46,436</span>,352  <span class="token number">6</span>.54MB/s 用时 <span class="token number">6</span>.6s   

<span class="token number">2022</span>-03-31 01:13:19 <span class="token punctuation">(</span><span class="token number">6.71</span> MB/s<span class="token punctuation">)</span> - 已保存 “kubectl.1” <span class="token punctuation">[</span><span class="token number">46436352</span>/46436352<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># ll -h kubectl</span>
-rwxr-xr-x <span class="token number">1</span> root root 45M <span class="token number">3</span>月  <span class="token number">31</span> 01:10 kubectl
</code></pre>
<p>现在Jenkins正在运行。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker ps | grep jenkins</span>
99b1d931eaf4   jenkins/jenkins:2.332.1-lts-centos7   <span class="token string">"/sbin/tini -- /usr/…"</span>   <span class="token number">14</span> hours ago   Up About an hour       <span class="token number">0.0</span>.0.0:8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, :::8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, <span class="token number">0.0</span>.0.0:50000-<span class="token operator">&gt;</span><span class="token number">50000</span>/tcp, :::50000-<span class="token operator">&gt;</span><span class="token number">50000</span>/tcp                          jenkins
</code></pre>
<p>把kubectl文件拷贝到jenkins容器。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker cp kubectl jenkins:/</span>
</code></pre>
<p>把kubeconfig文件kctest拷贝到jenkins容器，kctest是我们自定义的kubeconfig文件，关于自定义kubeconfig文件的详细内容，请查看博客《<a href="https://www.cnblogs.com/renshengdezheli/p/17495272.html" target="_blank">Kubernetes(k8s)访问控制：身份认证</a>》。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker cp kctest jenkins:/</span>
</code></pre>
<p>以root身份进入jenkins容器。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -u root -it jenkins bash </span>

<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># ls /</span>
anaconda-post.log  bin  dev  etc  home  kctest  kubectl  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var

<span class="token comment">#给kubectl和kctest授权</span>
<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># chmod +x kubectl </span>

<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># chmod 644 kctest </span>

<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># ll -h kctest kubectl </span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">5</span>.4K Mar <span class="token number">18</span> 08:24 kctest
-rwxr-xr-x <span class="token number">1</span> root root  45M Mar <span class="token number">30</span> <span class="token number">17</span>:17 kubectl

<span class="token comment">#连接k8s集群，查看k8s集群节点状态，可以看到Jenkins成功连接k8s集群，但是用户test没有查看节点状态的权限。</span>
<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># ./kubectl --kubeconfig=kctest get nodes</span>
Error from server <span class="token punctuation">(</span>Forbidden<span class="token punctuation">)</span>: nodes is forbidden: User <span class="token string">"test"</span> cannot list resource <span class="token string">"nodes"</span> <span class="token keyword">in</span> API group <span class="token string">""</span> at the cluster scope

<span class="token comment">#退出容器</span>
<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
</code></pre>
<p>对test用户授予cluster-admin权限，cluster-admin是集群管理员权限，权限很大，关于授权的详细内容，请查看博客《<a href="https://www.cnblogs.com/renshengdezheli/p/17504354.html" target="_blank">Kubernetes(k8s)访问控制：权限管理之RBAC鉴权</a>》。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl create clusterrolebinding test --clusterrole=cluster-admin --user=test</span>
clusterrolebinding.rbac.authorization.k8s.io/test created
</code></pre>
<p>再次以root身份进入jenkins容器。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -u root -it jenkins bash </span>

<span class="token comment">#给用户test授权之后，jenkins能连接k8s集群，并能查看k8s集群节点状态。</span>
<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># ./kubectl --kubeconfig=kctest get node</span>
NAME         STATUS   ROLES                  AGE   VERSION
k8scloude1   Ready    control-plane,master   80d   v1.21.0
k8scloude2   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 80d   v1.21.0
k8scloude3   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 80d   v1.21.0

<span class="token comment">#查看k8s集群safe命名空间的pod</span>
<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># ./kubectl --kubeconfig=kctest get pod -n safe</span>
No resources found <span class="token keyword">in</span> safe namespace.

<span class="token comment">#退出容器</span>
<span class="token punctuation">[</span>root@99b1d931eaf4 /<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
</code></pre>
<p>自此，jenkins就可以远程连接k8s环境了。</p>
<h1 id="九创建jenkins项目">九.创建jenkins项目<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>首页点击新建任务，任务名称可以自定义，选择构建一个自由风格的软件项目，点击确定。</p>
<p><img src="./k8s_files/image-20230626182431763.png" alt="image-20230626182431763" loading="lazy" class="medium-zoom-image"></p>
<p>配置构建触发器，这样gitlab就可以触发jenkins了，在构建触发器那里选中触发远程构建（例如，使用脚本），身份验证令牌自定义。</p>
<p>注意：链接  JENKINS_URL/job/devopsProject/build?token= TOKEN_NAME，这个链接用于 gitlab 在触发 jenkins 时用到的链接，我们这里，TOKEN_NAME 的值是connect123，JENKINS_URL 是 192.168.110.133:8080，所以整个链接为：<br>
<a href="http://192.168.110.133:8080/job/devopsProject/build?token=connect123%E3%80%82" target="_blank" rel="noopener nofollow">http://192.168.110.133:8080/job/devopsProject/build?token=connect123。</a></p>
<p><img src="./k8s_files/image-20230626182508767.png" alt="image-20230626182508767" loading="lazy" class="medium-zoom-image"></p>
<p>当gitlab代码仓库内容变动之后，会去触发jenkins，所以需要增加构建步骤。</p>
<p>点击构建--&gt;增加构建步骤，选择执行shell。</p>
<p><img src="./k8s_files/image-20230628104349864.png" alt="image-20230628104349864" loading="lazy" class="medium-zoom-image"></p>
<p>程序员提交了代码到gitlab之后，jenkins需要重新拉取新代码，这时要先删除家目录下的旧代码，再拉取新代码，不然会报错。</p>
<p>对于jenkins容器来说，家目录就是/var/jenkins_home，进入Jenkins容器。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it jenkins bash</span>

<span class="token comment">#cd ~表示进入家目录</span>
bash-4.2$ <span class="token builtin class-name">cd</span> ~

<span class="token comment">#可以看到家目录为/var/jenkins_home</span>
bash-4.2$ <span class="token builtin class-name">pwd</span>
/var/jenkins_home

<span class="token comment">#退出容器</span>
bash-4.2$ <span class="token builtin class-name">exit</span>
<span class="token builtin class-name">exit</span>
</code></pre>
<p>在构建--&gt;增加构建步骤--&gt;执行shell里输入如下语句，意思为进入jenkins容器家目录，删除旧代码，拉取新代码。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token builtin class-name">cd</span> ~
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> my-project
<span class="token function">git</span> clone http://192.168.110.133/root/my-project.git
</code></pre>
<p>在构建--&gt;增加构建步骤--&gt;执行shell里输入如下语句。</p>
<p><img src="./k8s_files/image-20230628104528933.png" alt="image-20230628104528933" loading="lazy" class="medium-zoom-image"></p>
<p>Jenkins把新代码拉取下来之后，需要进行编译，接下来继续增加构建步骤，这次类型选择Build/Publish Docker Image。</p>
<p><img src="./k8s_files/image-20230628104618671.png" alt="image-20230628104618671" loading="lazy" class="medium-zoom-image"></p>
<p>Build/Publish Docker Image--&gt;Directory for Dockerfile里填/var/jenkins_home/my-project/，jenkins拉取代码是放在家目录下，Dockerfile也在家目录/var/jenkins_home/my-project/下。</p>
<p>Cloud选择docker，使用docker编译Dockerfile。</p>
<p>Image填：192.168.110.133:5000/devopsproject/nginx:<span class="math inline"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-1-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 109%; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#xFF0C;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x8868;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x793A;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x628A;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x7F16;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x8BD1;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x597D;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x7684;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x955C;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x50CF;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x63A8;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x9001;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x5230;&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x4ED3;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x5E93;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#xFF0C;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x56E0;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x4E3A;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x4EE3;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x7801;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x4F1A;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x4E0D;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x65AD;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x66F4;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x65B0;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#xFF0C;&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x4F1A;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x88AB;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x7F16;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x8BD1;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x597D;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x591A;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x6B21;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#xFF0C;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x6240;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x4EE5;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x4F7F;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x7528;&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-1" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-2" class="mjx-mrow"><span id="MJXc-Node-3" class="mjx-texatom"><span id="MJXc-Node-4" class="mjx-mrow"><span id="MJXc-Node-5" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em;">B</span></span><span id="MJXc-Node-6" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em; padding-right: 0.084em;">U</span></span><span id="MJXc-Node-7" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em; padding-right: 0.064em;">I</span></span><span id="MJXc-Node-8" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em;">L</span></span><span id="MJXc-Node-9" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-10" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-11" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em; padding-right: 0.085em;">N</span></span></span></span><span id="MJXc-Node-12" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em; padding-right: 0.084em;">U</span></span><span id="MJXc-Node-13" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em; padding-right: 0.081em;">M</span></span><span id="MJXc-Node-14" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em;">B</span></span><span id="MJXc-Node-15" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em; padding-right: 0.026em;">E</span></span><span id="MJXc-Node-16" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em;">R</span></span></span></span><span id="MJXc-Node-17" class="mjx-texatom"><span id="MJXc-Node-18" class="mjx-mrow"><span id="MJXc-Node-19" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">，</span></span></span></span></span><span id="MJXc-Node-20" class="mjx-texatom"><span id="MJXc-Node-21" class="mjx-mrow"><span id="MJXc-Node-22" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">表</span></span></span></span></span><span id="MJXc-Node-23" class="mjx-texatom"><span id="MJXc-Node-24" class="mjx-mrow"><span id="MJXc-Node-25" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">示</span></span></span></span></span><span id="MJXc-Node-26" class="mjx-texatom"><span id="MJXc-Node-27" class="mjx-mrow"><span id="MJXc-Node-28" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">把</span></span></span></span></span><span id="MJXc-Node-29" class="mjx-texatom"><span id="MJXc-Node-30" class="mjx-mrow"><span id="MJXc-Node-31" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">编</span></span></span></span></span><span id="MJXc-Node-32" class="mjx-texatom"><span id="MJXc-Node-33" class="mjx-mrow"><span id="MJXc-Node-34" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">译</span></span></span></span></span><span id="MJXc-Node-35" class="mjx-texatom"><span id="MJXc-Node-36" class="mjx-mrow"><span id="MJXc-Node-37" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">好</span></span></span></span></span><span id="MJXc-Node-38" class="mjx-texatom"><span id="MJXc-Node-39" class="mjx-mrow"><span id="MJXc-Node-40" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">的</span></span></span></span></span><span id="MJXc-Node-41" class="mjx-texatom"><span id="MJXc-Node-42" class="mjx-mrow"><span id="MJXc-Node-43" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">镜</span></span></span></span></span><span id="MJXc-Node-44" class="mjx-texatom"><span id="MJXc-Node-45" class="mjx-mrow"><span id="MJXc-Node-46" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">像</span></span></span></span></span><span id="MJXc-Node-47" class="mjx-texatom"><span id="MJXc-Node-48" class="mjx-mrow"><span id="MJXc-Node-49" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">推</span></span></span></span></span><span id="MJXc-Node-50" class="mjx-texatom"><span id="MJXc-Node-51" class="mjx-mrow"><span id="MJXc-Node-52" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">送</span></span></span></span></span><span id="MJXc-Node-53" class="mjx-texatom"><span id="MJXc-Node-54" class="mjx-mrow"><span id="MJXc-Node-55" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">到</span></span></span></span></span><span id="MJXc-Node-56" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.286em;">r</span></span><span id="MJXc-Node-57" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.286em;">e</span></span><span id="MJXc-Node-58" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.498em; padding-right: 0.003em;">g</span></span><span id="MJXc-Node-59" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em;">i</span></span><span id="MJXc-Node-60" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.286em;">s</span></span><span id="MJXc-Node-61" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em;">t</span></span><span id="MJXc-Node-62" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.286em;">r</span></span><span id="MJXc-Node-63" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.498em; padding-right: 0.006em;">y</span></span><span id="MJXc-Node-64" class="mjx-texatom"><span id="MJXc-Node-65" class="mjx-mrow"><span id="MJXc-Node-66" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">仓</span></span></span></span></span><span id="MJXc-Node-67" class="mjx-texatom"><span id="MJXc-Node-68" class="mjx-mrow"><span id="MJXc-Node-69" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">库</span></span></span></span></span><span id="MJXc-Node-70" class="mjx-texatom"><span id="MJXc-Node-71" class="mjx-mrow"><span id="MJXc-Node-72" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">，</span></span></span></span></span><span id="MJXc-Node-73" class="mjx-texatom"><span id="MJXc-Node-74" class="mjx-mrow"><span id="MJXc-Node-75" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">因</span></span></span></span></span><span id="MJXc-Node-76" class="mjx-texatom"><span id="MJXc-Node-77" class="mjx-mrow"><span id="MJXc-Node-78" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">为</span></span></span></span></span><span id="MJXc-Node-79" class="mjx-texatom"><span id="MJXc-Node-80" class="mjx-mrow"><span id="MJXc-Node-81" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">代</span></span></span></span></span><span id="MJXc-Node-82" class="mjx-texatom"><span id="MJXc-Node-83" class="mjx-mrow"><span id="MJXc-Node-84" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">码</span></span></span></span></span><span id="MJXc-Node-85" class="mjx-texatom"><span id="MJXc-Node-86" class="mjx-mrow"><span id="MJXc-Node-87" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">会</span></span></span></span></span><span id="MJXc-Node-88" class="mjx-texatom"><span id="MJXc-Node-89" class="mjx-mrow"><span id="MJXc-Node-90" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">不</span></span></span></span></span><span id="MJXc-Node-91" class="mjx-texatom"><span id="MJXc-Node-92" class="mjx-mrow"><span id="MJXc-Node-93" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">断</span></span></span></span></span><span id="MJXc-Node-94" class="mjx-texatom"><span id="MJXc-Node-95" class="mjx-mrow"><span id="MJXc-Node-96" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">更</span></span></span></span></span><span id="MJXc-Node-97" class="mjx-texatom"><span id="MJXc-Node-98" class="mjx-mrow"><span id="MJXc-Node-99" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">新</span></span></span></span></span><span id="MJXc-Node-100" class="mjx-texatom"><span id="MJXc-Node-101" class="mjx-mrow"><span id="MJXc-Node-102" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">，</span></span></span></span></span><span id="MJXc-Node-103" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em;">D</span></span><span id="MJXc-Node-104" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.286em;">o</span></span><span id="MJXc-Node-105" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.286em;">c</span></span><span id="MJXc-Node-106" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.498em; padding-bottom: 0.286em;">k</span></span><span id="MJXc-Node-107" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.286em;">e</span></span><span id="MJXc-Node-108" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.286em;">r</span></span><span id="MJXc-Node-109" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.498em; padding-bottom: 0.498em; padding-right: 0.06em;">f</span></span><span id="MJXc-Node-110" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.427em; padding-bottom: 0.286em;">i</span></span><span id="MJXc-Node-111" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.498em; padding-bottom: 0.286em;">l</span></span><span id="MJXc-Node-112" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.215em; padding-bottom: 0.286em;">e</span></span><span id="MJXc-Node-113" class="mjx-texatom"><span id="MJXc-Node-114" class="mjx-mrow"><span id="MJXc-Node-115" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">会</span></span></span></span></span><span id="MJXc-Node-116" class="mjx-texatom"><span id="MJXc-Node-117" class="mjx-mrow"><span id="MJXc-Node-118" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">被</span></span></span></span></span><span id="MJXc-Node-119" class="mjx-texatom"><span id="MJXc-Node-120" class="mjx-mrow"><span id="MJXc-Node-121" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">编</span></span></span></span></span><span id="MJXc-Node-122" class="mjx-texatom"><span id="MJXc-Node-123" class="mjx-mrow"><span id="MJXc-Node-124" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">译</span></span></span></span></span><span id="MJXc-Node-125" class="mjx-texatom"><span id="MJXc-Node-126" class="mjx-mrow"><span id="MJXc-Node-127" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">好</span></span></span></span></span><span id="MJXc-Node-128" class="mjx-texatom"><span id="MJXc-Node-129" class="mjx-mrow"><span id="MJXc-Node-130" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">多</span></span></span></span></span><span id="MJXc-Node-131" class="mjx-texatom"><span id="MJXc-Node-132" class="mjx-mrow"><span id="MJXc-Node-133" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">次</span></span></span></span></span><span id="MJXc-Node-134" class="mjx-texatom"><span id="MJXc-Node-135" class="mjx-mrow"><span id="MJXc-Node-136" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">，</span></span></span></span></span><span id="MJXc-Node-137" class="mjx-texatom"><span id="MJXc-Node-138" class="mjx-mrow"><span id="MJXc-Node-139" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">所</span></span></span></span></span><span id="MJXc-Node-140" class="mjx-texatom"><span id="MJXc-Node-141" class="mjx-mrow"><span id="MJXc-Node-142" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">以</span></span></span></span></span><span id="MJXc-Node-143" class="mjx-texatom"><span id="MJXc-Node-144" class="mjx-mrow"><span id="MJXc-Node-145" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">使</span></span></span></span></span><span id="MJXc-Node-146" class="mjx-texatom"><span id="MJXc-Node-147" class="mjx-mrow"><span id="MJXc-Node-148" class="mjx-mo"><span class="mjx-char" style="padding-top: 0.498em; padding-bottom: 0.215em;"><span class="mjx-charbox MJXc-TeX-unknown-R" style="padding-bottom: 0.311em; width: 1.002em;">用</span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi>B</mi><mi>U</mi><mi>I</mi><mi>L</mi><msub><mi>D</mi><mi>N</mi></msub><mi>U</mi><mi>M</mi><mi>B</mi><mi>E</mi><mi>R</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>表</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>示</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>把</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>编</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>译</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>好</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>的</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>镜</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>像</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>推</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>送</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>到</mo></mrow><mi>r</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>仓</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>库</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>因</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>为</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>代</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>码</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>会</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>不</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>断</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>更</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>新</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mi>D</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>会</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>被</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>编</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>译</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>好</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>多</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>次</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>所</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>以</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>使</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>用</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-1">{BUILD_NUMBER}，表示把编译好的镜像推送到registry仓库，因为代码会不断更新，Dockerfile会被编译好多次，所以使用</script></span>{BUILD_NUMBER}变量，让镜像不重复，本次代码变动主要是nginx，所以写为nginx:${BUILD_NUMBER}。</p>
<p>选中Push image，把镜像推送到镜像仓库。</p>
<p><img src="./k8s_files/image-20230628104710992.png" alt="image-20230628104710992" loading="lazy" class="medium-zoom-image"></p>
<p>把新代码拉取下来，Dockerfile被编译好并推送到镜像仓库之后，需要把新镜像部署到k8s环境，接下来继续增加构建步骤，这次类型选择执行shell。</p>
<p><img src="./k8s_files/image-20230628104752594.png" alt="image-20230628104752594" loading="lazy" class="medium-zoom-image"></p>
<p>执行shell里输入如下语句，解释如下：</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token comment">#export KUBECONFIG=/kctest定义KUBECONFIG，不然每次执行kubectl命令都要加上kubectl --kubeconfig=kctest</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/kctest

<span class="token comment">#在devops命名空间里，替换deployment/nginx的镜像为192.168.110.133:5000/devopsproject/nginx:${BUILD_NUMBER}</span>
/kubectl <span class="token builtin class-name">set</span> image deployment/nginx <span class="token assign-left variable">nginx</span><span class="token operator">=</span><span class="token string">"192.168.110.133:5000/devopsproject/nginx:<span class="token variable">${BUILD_NUMBER}</span>"</span> <span class="token parameter variable">-n</span> devops
</code></pre>
<p>最后点击保存。</p>
<p><img src="./k8s_files/image-20230628105007570.png" alt="image-20230628105007570" loading="lazy" class="medium-zoom-image"></p>
<h1 id="十创建deployment">十.创建deployment<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>现在回到Kubernetes(k8s)集群，因为jenkins把新镜像部署到devops命名空间下，所以创建一个命名空间devops。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl create namespace devops</span>
namespace/devops created
</code></pre>
<p>切换命名空间到devops。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># kubens devops</span>
Context <span class="token string">"kubernetes-admin@kubernetes"</span> modified.
Active namespace is <span class="token string">"devops"</span><span class="token builtin class-name">.</span>
</code></pre>
<p>现在没有deploy。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy</span>
No resources found <span class="token keyword">in</span> devops namespace.
</code></pre>
<p>使用Nginx镜像创建一个deploy，配置文件如下：</p>
<p>功能为：创建一个名为"nginx"的Deployment对象，Pod副本数为1。关于deployment的详细内容，请查看博客《<a href="https://www.cnblogs.com/renshengdezheli/p/17100338.html" target="_blank">Kubernetes(k8s)控制器(一)：deployment</a>》。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-yaml" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-yaml"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># vim nginx.yaml </span>

<span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># cat nginx.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment">#replicas: 1 指定需要运行的Pod副本数量为1个。</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token comment">#当需要关闭容器时，立即杀死容器而不等待默认的30秒优雅停机时长。</span>
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token comment">#image: nginx: 指定要使用的镜像为"nginx"。</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token comment">#imagePullPolicy: IfNotPresent：表示如果本地已经存在该镜像，则不重新下载；否则从远程 Docker Hub 下载该镜像</span>
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<p>创建deploy。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f nginx.yaml </span>
deployment.apps/nginx created
</code></pre>
<p>deployment创建成功。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx-6cf858f6cf-rltvh   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6s

<span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy</span>
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           12s
</code></pre>
<p>给deploy创建一个名为nginxsvc的svc，端口为80，svc类型为NodePort，关于svc的详细内容，请查看博客《<a href="https://www.cnblogs.com/renshengdezheli/p/17460981.html" target="_blank">Kubernetes(k8s)服务service：service的发现和service的发布</a>》。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl expose --name=nginxsvc deploy nginx --port=80 --type=NodePort</span>
service/nginxsvc exposed
</code></pre>
<p>查看svc。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc</span>
NAME       TYPE       CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
nginxsvc   NodePort   <span class="token number">10.107</span>.202.119   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30151/TCP   9s
</code></pre>
<p>在浏览器访问 192.168.110.130:30151，即可访问nginx界面。</p>
<p><img src="./k8s_files/image-20230628105148242.png" alt="image-20230628105148242" loading="lazy" class="medium-zoom-image"></p>
<h1 id="十一配置gitlab触发jenkins">十一.配置gitlab触发jenkins<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>接下来回到gitlab，配置gitlab触发jenkins。</p>
<p>gitlab首页依次点击管理区域--&gt;设置--&gt;Outbound requests，展开Outbound requests，勾选允许钩子和服务访问本地网络，保存修改，这样jenkins才能访问gitlab代码仓库。</p>
<p><img src="./k8s_files/image-20230628105220689.png" alt="image-20230628105220689" loading="lazy" class="medium-zoom-image"></p>
<p>首页点击项目--&gt;您的项目，点击进入my-project项目。</p>
<p><img src="./k8s_files/image-20230628105303219.png" alt="image-20230628105303219" loading="lazy" class="medium-zoom-image"></p>
<p>选择设置--&gt;集成。</p>
<p><img src="./k8s_files/image-20230628105341176.png" alt="image-20230628105341176" loading="lazy" class="medium-zoom-image"></p>
<p>注意：链接  JENKINS_URL/job/devopsProject/build?token= TOKEN_NAME，这个链接用于 gitlab 在触发 jenkins 时用到的链接，我们这里，TOKEN_NAME 的值是connect123，JENKINS_URL 是 192.168.110.133:8080，所以整个链接为：<br>
<a href="http://192.168.110.133:8080/job/devopsProject/build?token=connect123" target="_blank" rel="noopener nofollow">http://192.168.110.133:8080/job/devopsProject/build?token=connect123</a> 。</p>
<p>链接(URL)填入gitlab 触发 jenkins 时用到的链接：<a href="http://192.168.110.133:8080/job/devopsProject/build?token=connect123" target="_blank" rel="noopener nofollow">http://192.168.110.133:8080/job/devopsProject/build?token=connect123</a></p>
<p><img src="./k8s_files/image-20230628105428519.png" alt="image-20230628105428519" loading="lazy" class="medium-zoom-image"></p>
<p>点击增加Web钩子。</p>
<p><img src="./k8s_files/image-20230628105455235.png" alt="image-20230628105455235" loading="lazy" class="medium-zoom-image"></p>
<p>Web钩子生成后进行测试，点击Test--&gt;Push events。</p>
<p><img src="./k8s_files/image-20230628105540502.png" alt="image-20230628105540502" loading="lazy" class="medium-zoom-image"></p>
<p>如果看到如下，则test成功，gitlab能触发jenkins了。</p>
<p><img src="./k8s_files/image-20230628105614145.png" alt="image-20230628105614145" loading="lazy" class="medium-zoom-image"></p>
<p>自此整个DevOps环境就搭建成功了。</p>
<h1 id="十二测试devops">十二.测试DevOps<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>DevOps环境搭建成功之后，我们需要来测试整个流程。</p>
<h2 id="121-写代码">12.1 写代码<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>进入项目。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># cd my-project/</span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># ls</span>
index.html
</code></pre>
<p>编写Dockerfile文件，关于Dockerfile详细内容，请查看博客《<a href="https://www.cnblogs.com/renshengdezheli/p/16645144.html" target="_blank">构建自定义镜像并优化dockerfile文件</a>》。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># vim Dockerfile </span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span>
<span class="token comment">#FROM指定基础镜像为docker.io/nginx:latest</span>
FROM docker.io/nginx:latest
<span class="token comment">#MAINTAINER指定作者为test</span>
MAINTAINER <span class="token builtin class-name">test</span>
<span class="token comment">#把index.html拷贝到容器里的/usr/share/nginx/html/目录</span>
ADD index.html /usr/share/nginx/html/
<span class="token comment">#暴露80号端口    </span>
EXPOSE <span class="token number">80</span>
<span class="token comment">#运行Nginx</span>
CMD <span class="token punctuation">[</span><span class="token string">"nginx"</span>, <span class="token string">"-g"</span>,<span class="token string">"daemon off;"</span><span class="token punctuation">]</span>
</code></pre>
<p>更新首页文件。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># vim index.html </span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># cat index.html </span>
hello everybody
XX同志提交了新代码
这是新镜像部署的nginx web应用
</code></pre>
<h2 id="122-上传代码到gitlab">12.2 上传代码到gitlab<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>git add命令把Dockerfile和index.html添加到暂存区。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/root/my-project

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># ls</span>
Dockerfile  index.html

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git add .</span>
</code></pre>
<p>添加注释。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git commit -m 'today new file'</span>
<span class="token punctuation">[</span>master ebee76d<span class="token punctuation">]</span> today new <span class="token function">file</span>
 <span class="token number">2</span> files changed, <span class="token number">8</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">1</span> deletion<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
 create mode <span class="token number">100644</span> Dockerfile
</code></pre>
<p>git push命令用于将本地分支的更新，推送到远程主机。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git push </span>
Counting objects: <span class="token number">6</span>, done.
Delta compression using up to <span class="token number">4</span> threads.
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span>, <span class="token number">493</span> bytes <span class="token operator">|</span> <span class="token number">0</span> bytes/s, done.
Total <span class="token number">4</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
To ssh://git@192.168.110.133:222/root/my-project.git
   773973b<span class="token punctuation">..</span>ebee76d  master -<span class="token operator">&gt;</span> master
</code></pre>
<p>去gitlab界面看文件是否推送成功，可以看到git push成功。</p>
<p><img src="./k8s_files/image-20230628105820542.png" alt="image-20230628105820542" loading="lazy" class="medium-zoom-image"></p>
<h2 id="123-jenkins执行cicd自动构建自动部署流程">12.3 Jenkins执行CI/CD(自动构建自动部署)流程<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>因为gitlab上的文件发生变动，jenkins会拉取gitlab上的文件，进行编译，然后上传新镜像到registry仓库，最后把新镜像部署到k8s环境。</p>
<p>点击状态，可以发现最新的#4已经构建成功，我们查看控制台输出。</p>
<p><img src="./k8s_files/image-20230628105931070.png" alt="image-20230628105931070" loading="lazy" class="medium-zoom-image"></p>
<p>下面解释了控制台输出的内容：</p>
<p><img src="./k8s_files/image-20230628110014137.png" alt="image-20230628110014137" loading="lazy" class="medium-zoom-image"></p>
<p><img src="./k8s_files/image-20230628110043308.png" alt="image-20230628110043308" loading="lazy" class="medium-zoom-image"></p>
<p><img src="./k8s_files/image-20230628110114243.png" alt="image-20230628110114243" loading="lazy" class="medium-zoom-image"></p>
<p>本来我们的nginx web界面是这样的。</p>
<p><img src="./k8s_files/image-20230628110211720.png" alt="image-20230628110211720" loading="lazy" class="medium-zoom-image"></p>
<p>刷新之后界面变为这样子(中文乱码了)，说明DEVOPS流程成功。</p>
<p><img src="./k8s_files/image-20230628110235939.png" alt="image-20230628110235939" loading="lazy" class="medium-zoom-image"></p>
<h2 id="124-再试一次">12.4 再试一次<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>再次更新首页文件index.html。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/root/my-project

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># ls</span>
Dockerfile  index.html

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># vim index.html </span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># cat index.html </span>
hello everybody
this is latest
</code></pre>
<p>提交代码到gitlab代码仓库。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git add .</span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git commit -m "latest and last"</span>
<span class="token punctuation">[</span>master a08be73<span class="token punctuation">]</span> latest and last
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">2</span> deletions<span class="token punctuation">(</span>-<span class="token punctuation">)</span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git push </span>
Counting objects: <span class="token number">5</span>, done.
Delta compression using up to <span class="token number">4</span> threads.
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">2</span>/2<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, <span class="token number">314</span> bytes <span class="token operator">|</span> <span class="token number">0</span> bytes/s, done.
Total <span class="token number">3</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
To ssh://git@192.168.110.133:222/root/my-project.git
   ebee76d<span class="token punctuation">..</span>a08be73  master -<span class="token operator">&gt;</span> master
</code></pre>
<p>到gitlab界面上查看新文件。</p>
<p><img src="./k8s_files/image-20230628110449041.png" alt="image-20230628110449041" loading="lazy" class="medium-zoom-image"></p>
<p>jenkins最新的也构建成功。</p>
<p><img src="./k8s_files/image-20230628110515388.png" alt="image-20230628110515388" loading="lazy" class="medium-zoom-image"></p>
<p>刷新nginx web界面，内容变为最新的了。</p>
<p><img src="./k8s_files/image-20230628110628503.png" alt="image-20230628110628503" loading="lazy" class="medium-zoom-image"></p>
<h2 id="125-降低用户权限继续测试cicd">12.5 降低用户权限继续测试CI/CD<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>需要注意的是前面我们给test用户授予了cluster-admin的权限，这个权限很大，我们可以把权限变小。</p>
<p>现在回到k8s环境给用户test授权。</p>
<p>创建目录存放yaml文件。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 ~<span class="token punctuation">]</span><span class="token comment"># mkdir devops</span>

<span class="token punctuation">[</span>root@k8scloude1 safe<span class="token punctuation">]</span><span class="token comment"># cd ~/devops/</span>
</code></pre>
<p>查看clusterrolebinding，可以看到给test用户绑定了cluster-admin。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 devops<span class="token punctuation">]</span><span class="token comment"># kubectl get clusterrolebinding | grep test</span>
<span class="token builtin class-name">test</span>                                                   ClusterRole/cluster-admin                                                          4h54m
</code></pre>
<p>编写角色yaml文件，文件功能为：创建名为role1的角色，该角色对pod，svc，deploy具有get，list，create，delete权限，对deploy具有get，list，create，delete，patch权限，关于授权的详细内容，请查看博客《<a href="https://www.cnblogs.com/renshengdezheli/p/17504354.html" target="_blank">Kubernetes(k8s)访问控制：权限管理之RBAC鉴权</a>》。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-yaml" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-yaml"><span class="token punctuation">[</span>root@k8scloude1 devops<span class="token punctuation">]</span><span class="token comment"># cat role1.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> role1
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">""</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> pods
  <span class="token punctuation">-</span> services
  <span class="token punctuation">-</span> deployments
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> delete
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"apps"</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> deployments
  <span class="token punctuation">-</span> deployments/scale
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> delete
  <span class="token punctuation">-</span> patch
</code></pre>
<p>创建角色。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 devops<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f role1.yaml </span>
role.rbac.authorization.k8s.io/role1 created
</code></pre>
<p>查看角色。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 devops<span class="token punctuation">]</span><span class="token comment"># kubectl get role</span>
NAME    CREATED AT
role1   <span class="token number">2022</span>-03-31T11:27:01Z
</code></pre>
<p>role1的权限如下:</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 devops<span class="token punctuation">]</span><span class="token comment"># kubectl describe role role1 </span>
Name:         role1
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
PolicyRule:
  Resources               Non-Resource URLs  Resource Names  Verbs
  ---------               -----------------  --------------  -----
  deployments.apps/scale  <span class="token punctuation">[</span><span class="token punctuation">]</span>                 <span class="token punctuation">[</span><span class="token punctuation">]</span>              <span class="token punctuation">[</span>get list create delete patch<span class="token punctuation">]</span>
  deployments.apps        <span class="token punctuation">[</span><span class="token punctuation">]</span>                 <span class="token punctuation">[</span><span class="token punctuation">]</span>              <span class="token punctuation">[</span>get list create delete patch<span class="token punctuation">]</span>
  deployments             <span class="token punctuation">[</span><span class="token punctuation">]</span>                 <span class="token punctuation">[</span><span class="token punctuation">]</span>              <span class="token punctuation">[</span>get list create delete<span class="token punctuation">]</span>
  pods                    <span class="token punctuation">[</span><span class="token punctuation">]</span>                 <span class="token punctuation">[</span><span class="token punctuation">]</span>              <span class="token punctuation">[</span>get list create delete<span class="token punctuation">]</span>
  services                <span class="token punctuation">[</span><span class="token punctuation">]</span>                 <span class="token punctuation">[</span><span class="token punctuation">]</span>              <span class="token punctuation">[</span>get list create delete<span class="token punctuation">]</span>
</code></pre>
<p>删除集群角色绑定test。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 devops<span class="token punctuation">]</span><span class="token comment"># kubectl delete clusterrolebinding test</span>
clusterrolebinding.rbac.authorization.k8s.io <span class="token string">"test"</span> deleted
</code></pre>
<p>给用户test授予role1权限。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@k8scloude1 devops<span class="token punctuation">]</span><span class="token comment"># kubectl create rolebinding test --role=role1 --user=test</span>
rolebinding.rbac.authorization.k8s.io/test created
</code></pre>
<p>把用户test权限变小之后，继续更新首页文件index.html。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 ~<span class="token punctuation">]</span><span class="token comment"># cd my-project/</span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># ls</span>
Dockerfile  index.html

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># vim index.html </span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># cat index.html </span>
hello everybody
this is rolebinding not clusterrolebinding
</code></pre>
<p>上传代码到gitlab。</p>
<pre class="highlighter-prismjs prismjs-lines-highlighted language-shell" tabindex="0" highlighted="true"><code class="highlighter-prismjs language-shell"><span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git add .</span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git commit -m "rolebinding"</span>
<span class="token punctuation">[</span>master 78b946a<span class="token punctuation">]</span> rolebinding
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">1</span> deletion<span class="token punctuation">(</span>-<span class="token punctuation">)</span>

<span class="token punctuation">[</span>root@etcd1 my-project<span class="token punctuation">]</span><span class="token comment"># git push </span>
Counting objects: <span class="token number">5</span>, done.
Delta compression using up to <span class="token number">4</span> threads.
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, <span class="token number">330</span> bytes <span class="token operator">|</span> <span class="token number">0</span> bytes/s, done.
Total <span class="token number">3</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
To ssh://git@192.168.110.133:222/root/my-project.git
   a08be73<span class="token punctuation">..</span>78b946a  master -<span class="token operator">&gt;</span> master
</code></pre>
<p>把test用户权限变小之后，变动文件，nginx web也变化为最新的了。</p>
<p><img src="./k8s_files/image-20230628110939932.png" alt="image-20230628110939932" loading="lazy" class="medium-zoom-image"></p>
<p>当然deploy的副本可以设置为大于1，这样就可以实现负载均衡，更换镜像的时候就不会出现不可用的情况，用户无感知。</p>
<h1 id="十三总结">十三.总结<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h1>
<p>通过使用GitLab、Jenkins和Kubernetes，我们成功地建立了一个完整的CI/CD解决方案。DevOps实践能够极大地提高软件开发和交付过程的效率和质量。持续集成和交付使团队能够更快地交付新功能并快速适应变化。</p>
<p>在实施CI/CD解决方案时，请根据您的项目需求和团队能力进行适当的调整和定制。</p>
<p>持续学习和实践是提高DevOps技能的关键。通过实战和不断探索，您将能够建立强大的CI/CD流程，提高软件交付的速度和质量。</p>

</div>
<div id="MySignature" role="contentinfo">
    致力于一条龙式的为您解决问题
</div>
<div class="clear"></div>
<div id="blog_post_info_block" role="contentinfo">


<div id="BlogPostCategory">
    分类: 
            <a href="https://www.cnblogs.com/renshengdezheli/category/1900233.html" target="_blank">完整项目实战</a>
,             <a href="https://www.cnblogs.com/renshengdezheli/category/2209000.html" target="_blank">docker容器</a>
,             <a href="https://www.cnblogs.com/renshengdezheli/category/2216390.html" target="_blank">Kubernetes(k8s)管理</a>
</div>

    <div id="blog_post_info">
<div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(17581423,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
        <a id="green_channel_follow" onclick="follow(&#39;39cbe1e5-ab9d-474f-1eae-08d76d60a59c&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_wechat" href="javascript:void(0);" onclick="shareManager.wechatShare()">微信分享</a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/renshengdezheli/" target="_blank"><img src="./k8s_files/20191120234954.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/renshengdezheli/">人生的哲理</a>
            <br>
            <a href="https://home.cnblogs.com/u/renshengdezheli/followers/">粉丝 - <span class="follower-count">111</span></a>
            <a href="https://home.cnblogs.com/u/renshengdezheli/followees/">关注 - <span class="following-count">0</span></a><br>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow" class="follow-tip">
                <a href="javascript:void(0);" onclick="follow(&#39;39cbe1e5-ab9d-474f-1eae-08d76d60a59c&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(17581423,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">4</span>
    </div>
    <div class="buryit" onclick="votePost(17581423,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
        <div id="vip_tip"><a class="tip" href="https://cnblogs.vip/" target="_blank">升级成为会员</a></div>
</div>

<script type="text/javascript">
    currentDiggType = 0;
</script>
</div>
    <div class="clear"></div>
    <div id="post_next_prev">

    <a href="https://www.cnblogs.com/renshengdezheli/p/17567249.html" class="p_n_p_prefix">« </a> 上一篇：    <a href="https://www.cnblogs.com/renshengdezheli/p/17567249.html" data-featured-image="" title="发布于 2023-07-20 04:44">Centos7 安装部署 Kubernetes(k8s) 高可用集群</a>
    <br>
    <a href="https://www.cnblogs.com/renshengdezheli/p/17632858.html" class="p_n_p_prefix">» </a> 下一篇：    <a href="https://www.cnblogs.com/renshengdezheli/p/17632858.html" data-featured-image="" title="发布于 2023-08-16 01:40">Ubuntu 安装部署Kubernetes(k8s)集群</a>

</div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="617.1044066350544" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2023-07-28 15:58" aria-expanded="false">2023-07-26 02:42</span>&nbsp;
<a href="https://www.cnblogs.com/renshengdezheli">人生的哲理</a>&nbsp;
阅读(<span id="post_view_count">5690</span>)&nbsp;
评论(<span id="post_comment_count">5</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=17581423" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(17581423);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: &#39;&#39;, targetType: &#39;blogPost&#39;, targetId: &#39;17581423&#39;, targetLink: &#39;https://www.cnblogs.com/renshengdezheli/p/17581423.html&#39;, title: &#39;DevOps实战：使用GitLab+Jenkins+Kubernetes(k8s)建立CI/CD解决方案&#39; })">举报</a>
</div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>
<script>
    var cb_entryId = 17581423, cb_entryCreatedDate = '2023-07-26 02:42', cb_postType = 1, cb_postTitle = 'DevOps实战：使用GitLab+Jenkins+Kubernetes(k8s)建立CI/CD解决方案';
    var allowComments = true, cb_blogId = 561551, cb_blogApp = 'renshengdezheli', cb_blogUserGuid = '39cbe1e5-ab9d-474f-1eae-08d76d60a59c';
    mermaidRender.render()
    markdown_highlight()
    zoomManager.apply("#cnblogs_post_body img:not(.code_img_closed):not(.code_img_opened)");    
</script>
<a id="!comments"></a>
<div id="blog-comments-placeholder"></div>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"> 
        <div class="comment-nav-right">
            <span id="span_refresh_tips"></span><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html#top">返回顶部</a>
        </div>
    </div>
    <div id="comment_form_container"><div class="login_tips">
    登录后才能查看或发表评论，立即 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return account.login(&#39;!comments&#39;);">登录</a> 或者
    <a href="https://www.cnblogs.com/">逛逛</a> 博客园首页
</div>
</div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
        <div id="cnblogs_ch"></div>
    <div id="opt_under_post"></div>
        <div id="blog_c1" class="under-post-card">
            <a href="https://www.trae.com.cn/?utm_source=advertising&amp;utm_medium=cnblogs_ug_cpa&amp;utm_term=hw_trae_cnblogs" rel="nofollow" target="_blank" onclick="countCreativeClicks(&#39;C1-字节-trae&#39;)">
                <img src="./k8s_files/35695-20250314212005023-452697622.jpg" onload="countCreativeImpressions(&#39;C1-字节-trae&#39;)" alt="">
                <span id="c1_impression" style="display:none"></span>
            </a>
        </div>
    <div id="under_post_card1">
<div class="under-post-card recomm-block">
    <b>相关博文：</b><br>
    <div class="recomm-list">
            <div class="recomm-item">
                <span>·&nbsp;</span>
                <a href="https://www.cnblogs.com/renshengdezheli/p/17100338.html" target="_blank" title="Kubernetes(k8s)控制器(一)：deployment" class="recomm-link">Kubernetes(k8s)控制器(一)：deployment</a>
            </div>
            <div class="recomm-item">
                <span>·&nbsp;</span>
                <a href="https://www.cnblogs.com/renshengdezheli/p/17504354.html" target="_blank" title="Kubernetes(k8s)访问控制：权限管理之RBAC授权/鉴权" class="recomm-link">Kubernetes(k8s)访问控制：权限管理之RBAC授权/鉴权</a>
            </div>
            <div class="recomm-item">
                <span>·&nbsp;</span>
                <a href="https://www.cnblogs.com/cal780-love/p/17169545.html" target="_blank" title="Docker搭建持续集成平台Jenkins----使用docker来安装Jenkins服务" class="recomm-link">Docker搭建持续集成平台Jenkins----使用docker来安装Jenkins服务</a>
            </div>
            <div class="recomm-item">
                <span>·&nbsp;</span>
                <a href="https://www.cnblogs.com/lixinliang/p/15901316.html" target="_blank" title="jenkins 持续集成部署k8s项目" class="recomm-link">jenkins 持续集成部署k8s项目</a>
            </div>
            <div class="recomm-item">
                <span>·&nbsp;</span>
                <a href="https://www.cnblogs.com/liaozhiwei/p/17618634.html" target="_blank" title="第四章：安装Docker，安装配置gitlab私有仓库以及jenkins自动化部署（图文）" class="recomm-link">第四章：安装Docker，安装配置gitlab私有仓库以及jenkins自动化部署（图文）</a>
            </div>
    </div>
</div>
</div>
    <div id="under_post_card2"><div class="itnews under-post-card">
    <b>阅读排行：</b>
    <br>
 ·          <a href="https://www.cnblogs.com/shanyou/p/18809051" target="_blank">BotSharp + MCP 三步实现智能体开发</a>
        <br>
 ·          <a href="https://www.cnblogs.com/tanshaoshenghao/p/18808156" target="_blank">动物智能之数据标注员——狗篇</a>
        <br>
 ·          <a href="https://www.cnblogs.com/TheMagicalRainbowSea/p/18809196" target="_blank">5. RabbitMQ 消息队列中 Exchanges(交换机) 的详细说明</a>
        <br>
 ·          <a href="https://www.cnblogs.com/xingchenheyue/p/18787234" target="_blank">设计模式脉络</a>
        <br>
 ·          <a href="https://www.cnblogs.com/xiaokang-coding/p/18801623" target="_blank">「硬核实战」回调函数到底是个啥？一文带你从原理到实战彻底掌握C/C++回调函数</a>
        <br>
</div></div>
    <div id="HistoryToday" class="under-post-card" style="display: none;"></div>
    <script type="text/javascript">
        var commentManager = new blogCommentManager();
        commentManager.renderComments(0);
        fixPostBody();
        window.footnoteTipManager.generateFootnoteTips();

            window.tocManager.displayDisableTocTips = false;
            window.tocManager.generateToc();
            
                setTimeout(function() { countViews(cb_blogId, cb_entryId); }, 50);
            
            deliverT2();
            deliverC1C2();
            loadNewsAndKb();
            
                LoadPostCategoriesTags(cb_blogId, cb_entryId);
            
            LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
            GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
            loadOptUnderPost();
            GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
                </script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->
	<div id="sideBar">
		<div id="sideBarMain">
			<div id="sidebar_news" class="newsItem">
    <h3 class="catListTitle">公告</h3>
<div id="blog-news">    
    <div id="sidebar_news_content">
<div id="profile_block">
    昵称：
    <a href="https://home.cnblogs.com/u/renshengdezheli/">
        人生的哲理
    </a>
    <br>
    园龄：
    <a href="https://home.cnblogs.com/u/renshengdezheli/" title="入园时间：2019-11-20">
        5年4个月
    </a>
    <br>
    粉丝：
    <a class="follower-count" href="https://home.cnblogs.com/u/renshengdezheli/followers/">
        111
    </a>
    <br>
    关注：
    <a class="folowing-count" href="https://home.cnblogs.com/u/renshengdezheli/followees/">
        0
    </a>
    <div id="p_b_follow" class="follow-tip">
<a href="javascript:void(0)" onclick="follow(&#39;39cbe1e5-ab9d-474f-1eae-08d76d60a59c&#39;)">+加关注</a></div>
    <script>getFollowStatus('39cbe1e5-ab9d-474f-1eae-08d76d60a59c');</script>
</div>
</div>
</div>
<script>loadBlogNews();</script>

 
</div>
<div id="sidebar_c3"></div>
			<div id="blog-calendar" style="">

<table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar" border="0">
    <tbody>
        <tr>
            <td colspan="7">
                <table class="CalTitle" cellspacing="0" border="0">
                    <tbody>
                        <tr>
                            <td class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2025/03/05&#39;); return false;">&lt;</a>
                            </td>
                            <td align="center">2025年4月</td>
                            <td align="right" class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2025/05/05&#39;); return false;">&gt;</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    <tr>
        <th class="CalDayHeader" align="center" abbr="日" scope="col">日</th>
        <th class="CalDayHeader" align="center" abbr="一" scope="col">一</th>
        <th class="CalDayHeader" align="center" abbr="二" scope="col">二</th>
        <th class="CalDayHeader" align="center" abbr="三" scope="col">三</th>
        <th class="CalDayHeader" align="center" abbr="四" scope="col">四</th>
        <th class="CalDayHeader" align="center" abbr="五" scope="col">五</th>
        <th class="CalDayHeader" align="center" abbr="六" scope="col">六</th>
    </tr>
            <tr>
                            <td class="CalOtherMonthDay" align="center">30</td>
                            <td class="CalOtherMonthDay" align="center">31</td>
                        <td class="" align="center">
                            1
                        </td>
                        <td class="" align="center">
                            2
                        </td>
                        <td class="" align="center">
                            3
                        </td>
                        <td class="" align="center">
                            4
                        </td>
                    <td class="CalTodayDay" align="center">
                        5
                    </td>
            </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            6
                        </td>
                            <td class="" align="center">
                                7
                            </td>
                            <td class="" align="center">
                                8
                            </td>
                            <td class="" align="center">
                                9
                            </td>
                            <td class="" align="center">
                                10
                            </td>
                            <td class="" align="center">
                                11
                            </td>
                        <td class="CalWeekendDay" align="center">
                            12
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            13
                        </td>
                            <td class="" align="center">
                                14
                            </td>
                            <td class="" align="center">
                                15
                            </td>
                            <td class="" align="center">
                                16
                            </td>
                            <td class="" align="center">
                                17
                            </td>
                            <td class="" align="center">
                                18
                            </td>
                        <td class="CalWeekendDay" align="center">
                            19
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            20
                        </td>
                            <td class="" align="center">
                                21
                            </td>
                            <td class="" align="center">
                                22
                            </td>
                            <td class="" align="center">
                                23
                            </td>
                            <td class="" align="center">
                                24
                            </td>
                            <td class="" align="center">
                                25
                            </td>
                        <td class="CalWeekendDay" align="center">
                            26
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            27
                        </td>
                            <td class="" align="center">
                                28
                            </td>
                            <td class="" align="center">
                                29
                            </td>
                            <td class="" align="center">
                                30
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                1
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                2
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            3
                        </td>
                </tr>
                <tr>
                        <td class="CalOtherMonthDay" align="center">
                            4
                        </td>
                            <td class="CalOtherMonthDay" align="center">
                                5
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                6
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                7
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                8
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                9
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            10
                        </td>
                </tr>
    </tbody>
</table></div><script>loadBlogDefaultCalendar();</script>			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><!-- 搜索 -->
<div id="sidebar_search" class="sidebar-block">
    <div class="mySearch my-search">
        <h3 class="catListTitle">搜索</h3>
        <div id="sidebar_search_box">
            <div id="widget_my_zzk" class="div_my_zzk">
                <input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk">
            </div>
            
        </div>
    </div>
</div>

<!-- 常用链接 -->
<div id="sidebar_shortcut" class="sidebar-block"><div class="catListLink">
<h3 class="catListTitle">
常用链接
</h3>
<ul>
    <li><a href="https://www.cnblogs.com/renshengdezheli/p/" title="我的博客的随笔列表">我的随笔</a></li>
<li><a href="https://www.cnblogs.com/renshengdezheli/MyComments.html" title="我的发表过的评论列表">我的评论</a></li>
<li><a href="https://www.cnblogs.com/renshengdezheli/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li>
<li><a href="https://www.cnblogs.com/renshengdezheli/comments" title="我的博客的评论列表">最新评论</a></li>
<li><a href="https://www.cnblogs.com/renshengdezheli/tag/" title="我的博客的标签列表">我的标签</a></li>

</ul>
</div>

</div>

<!-- 最新随笔 -->


<!-- 我的标签 -->
<div id="sidebar_toptags" class="sidebar-block"></div>

<!-- 积分与排名 -->


<!-- 随笔分类、随笔档案、文章分类、新闻分类、相册、链接 -->
<div id="sidebar_categories">

    <div id="sidebar_postcategory" class="catListPostCategory sidebar-block">
        <h3 class="catListTitle">
            
    <a class="sidebar-card-title-a" href="https://www.cnblogs.com/renshengdezheli/post-categories">随笔分类</a>



        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/2294879.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">ChatGPT(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/2216032.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">containerd容器(11)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/2209000.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">docker容器(73)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/2217833.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">etcd数据库(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/2216390.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">Kubernetes(k8s)管理(69)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/1597883.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">Linux操作系统模块(53)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/2180988.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">Windows操作系统模块(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/2236010.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">服务网格istio(13)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/1597882.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">数据库模块(3)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/category/1900233.html" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">完整项目实战(5)</a>
 
                </li>                
            
        </ul>


    </div>    
    <div id="sidebar_postarchive" class="catListPostArchive sidebar-block">
        <h3 class="catListTitle">
            
随笔档案


        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2024/11" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2024年11月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2024/06" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2024年6月(10)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2024/05" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2024年5月(6)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2023/08" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2023年8月(5)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2023/07" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2023年7月(5)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2023/06" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2023年6月(15)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2023/04" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2023年4月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2023/02" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2023年2月(6)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2022/12" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2022年12月(6)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2022/11" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2022年11月(7)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2022/10" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2022年10月(14)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2022/09" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2022年9月(14)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2022/08" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2022年8月(4)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2022/06" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2022年6月(3)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2020/12" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2020年12月(6)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2020/11" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2020年11月(41)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2020/08" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2020年8月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2020/05" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2020年5月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/renshengdezheli/p/archive/2019/11" style="--cnb-category-item-link-indent-size: calc(0 * 1em)" class="category-item-link" rel="" target="">2019年11月(1)</a>
 
                </li>                
            <li>
                <a href="javascript:void(0)" onclick="sideColumnManager.loadMore(this)">更多</a>
            </li>
        </ul>


    </div>    
</div>

<!-- 最新评论 -->
<!-- 阅读排行榜 -->
<div id="sidebar_topviewedposts" class="sidebar-block"><div class="catListView">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/renshengdezheli/most-viewed" class="sidebar-card-title-a">
    阅读排行榜
</a>

    </h3>
    <div id="TopViewPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/13941563.html">
                            1. linux下使用fdisk进行磁盘分区详解(25563)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/16686769.html">
                            2. Centos7 安装部署Kubernetes(k8s)集群(19863)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/13926829.html">
                            3. centos 7网卡配置文件详解（ifcfg-ens33）(16152)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/13947125.html">
                            4. linux用户管理:创建用户，删除用户，管理用户，用户配置(15327)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/16646969.html">
                            5. 搭建docker镜像仓库(一)：使用registry搭建本地镜像仓库(13566)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 评论排行榜 -->
<div id="sidebar_topcommentedposts" class="sidebar-block"><div class="catListFeedback">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/renshengdezheli/most-commented" class="sidebar-card-title-a">评论排行榜</a>

    </h3>
    <div id="TopFeedbackPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/16686769.html">
                            1. Centos7 安装部署Kubernetes(k8s)集群(10)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html">
                            2. DevOps实战：使用GitLab+Jenkins+Kubernetes(k8s)建立CI/CD解决方案(5)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/17567249.html">
                            3. Centos7 安装部署 Kubernetes(k8s) 高可用集群(4)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/17480603.html">
                            4. Kubernetes(k8s)包管理工具Helm：Helm包管理(4)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/renshengdezheli/p/17656550.html">
                            5. Visual Studio Code(vscode)下载慢 插件安装失败解决方案(3)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 推荐排行榜 -->
<div id="sidebar_topdiggedposts" class="sidebar-block">
<div id="topdigg_posts_wrap">
    <div class="catListView">
        <h3 class="catListTitle">
            <a href="https://www.cnblogs.com/renshengdezheli/most-liked" class="sidebar-card-title-a">推荐排行榜</a>

        </h3>
        <div id="TopDiggPostsBlock">
            <ul style="word-break: break-all">
                        <li>
                            <a href="https://www.cnblogs.com/renshengdezheli/p/16686769.html">
                                1. Centos7 安装部署Kubernetes(k8s)集群(7)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/renshengdezheli/p/13941563.html">
                                2. linux下使用fdisk进行磁盘分区详解(7)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/renshengdezheli/p/17581423.html">
                                3. DevOps实战：使用GitLab+Jenkins+Kubernetes(k8s)建立CI/CD解决方案(4)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/renshengdezheli/p/18258180">
                                4. 以沙箱的方式运行容器:安全容器gvisor(3)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/renshengdezheli/p/17645701.html">
                                5. 使用MD5算法和sha512sum校验和检验文件完整性(2)
                            </a>
                        </li>
            </ul>
        </div>
    </div>
</div></div><div id="sidebar_recentcomments" class="sidebar-block"><div class="catListComment">
<h3 class="catListTitle"><a href="https://www.cnblogs.com/renshengdezheli/comments" class="sidebar-card-title-a">最新评论</a></h3>
    <div class="RecentCommentBlock">
        <ul>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/renshengdezheli/p/16814395.html">1. Re:轻松下载k8s.gcr.io，gcr.io，quay.io镜像</a></li>
                <li class="recent_comment_body"><p>感谢</p>
</li>
                <li class="recent_comment_author">--zhq3210</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/renshengdezheli/p/13427865.html">2. Re:linux查询操作系统信息，CPU物理个数，CPU核心数，逻辑CPU数，内存信息查询，硬盘信息查询</a></li>
                <li class="recent_comment_body"><p>感谢，就你写的仔细，易懂</p>
</li>
                <li class="recent_comment_author">--xiaoaojianghu993</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/renshengdezheli/p/17452237.html">3. Re:Kubernetes(k8s)定时任务：CronJob</a></li>
                <li class="recent_comment_body"><p>cronjbo支持秒级？？？</p>
</li>
                <li class="recent_comment_author">--切开的苹果==HW</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/renshengdezheli/p/17632858.html">4. Re:Ubuntu 安装部署Kubernetes(k8s)集群</a></li>
                <li class="recent_comment_body">@人生的哲理 fighting...</li>
                <li class="recent_comment_author">--一个路过的小盆友</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/renshengdezheli/p/18519390">5. Re:Kubernetes集群证书过期解决方案：使用kubeadm为证书续期</a></li>
                <li class="recent_comment_body"><p>fighting</p>
</li>
                <li class="recent_comment_author">--人生的哲理</li>
        </ul>
    </div>
</div>

</div>


</div>
                    <script>loadBlogSideColumn();</script>
			</div>			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright © 2025 人生的哲理
<br><span id="poweredby">Powered by .NET 9.0 on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->



    

    <input type="hidden" id="antiforgery_token" value="CfDJ8KL9kPW-LSFBi_9YdTzcC08R6oTkdLgxxUhuBq7_7uRk3R5xhGRc4XzGpSsExB7KUZ-54_7l-joaNjRatjbjCUtO3iqbF97flUsWLaTTLh6BWgi-X9BQtbLZ9ca0Vf21PmKwe9NNJbmj3kqO0jcL9Cw">
    <script async="" src="./k8s_files/js"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-M95P3TTWJZ');
</script>
<script defer="" src="./k8s_files/hm.js.下载"></script>


<div style="z-index: 998; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: none; flex-direction: column; align-items: center; justify-content: center">
<div style="background: #fff;padding: 30px; margin: 30px; border-radius: 16px;">
  <div style="width: 200px; height: 200px; background: rgba(255, 255, 255, 0.8); position: absolute; top: -100px; right: -100px; border-radius: 100px"></div>
  <div style="text-align: center; font-size: 18px; margin-bottom: 10px;">点击右上角即可分享</div>
  <img src="./k8s_files/35695-20230906145857937-1471873834.gif" alt="微信分享提示">
</div>   
    </div></body></html>